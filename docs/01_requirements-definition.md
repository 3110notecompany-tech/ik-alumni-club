# IK ALUMNI CGT サポーターズクラブ会員サイト

## 要件定義書

**作成日**: 2025-12-09
**バージョン**: 1.0

---

## 目次

1. [システム化の目的と範囲](#1-システム化の目的と範囲)
2. [業務要件（一覧）](#2-業務要件一覧)
3. [業務要件（フロー図）](#3-業務要件フロー図)
4. [機能要件（一覧）](#4-機能要件一覧)
5. [補足：機能と配置イメージ](#5-補足機能と配置イメージ)
6. [非機能要件（一覧）](#6-非機能要件一覧)
   - [可用性](#61-可用性)
   - [性能](#62-性能)
   - [セキュリティー](#63-セキュリティー)
   - [移行性](#64-移行性)
   - [プロジェクト上の留意事項](#65-プロジェクト上の留意事項)

---

## 1. システム化の目的と範囲

### 1.1 目的

IK ALUMNI CGT サポーターズクラブの会員向けWebサイトを構築し、以下を実現する：

- **ファンクラブ運営のデジタル化**: 会員情報・コンテンツをWeb上で一元管理
- **会員限定コンテンツの提供**: ブログ、動画、会報などの限定コンテンツを会員に提供
- **24時間365日のコンテンツアクセス**: いつでもどこからでもコンテンツにアクセス可能
- **会員管理の効率化**: 会員登録、プラン管理、決済をオンラインで完結
- **情報発信の強化**: お知らせ、スケジュール、動画などをタイムリーに発信

### 1.2 解決する課題

| # | 課題 | 解決策 |
|---|------|--------|
| 1 | 会員情報の手動管理による非効率 | Webシステムによる自動化 |
| 2 | 会員限定コンテンツの配信手段がない | 会員認証付きWebサイトで配信 |
| 3 | 会費徴収の手間 | Stripe決済による自動課金 |
| 4 | イベント情報の周知が困難 | Webサイトでのスケジュール公開 |

### 1.3 範囲

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         システム化の範囲                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    公開Webサイト                                  │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │  HOME   │ │  INFO   │ │SCHEDULE │ │  VIDEO  │ │  BLOG   │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                │                                        │
│                                ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    会員専用エリア                                  │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐               │   │
│  │  │ MYPAGE  │ │限定BLOG │ │限定VIDEO│ │NEWSLETTER│               │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                │                                        │
│                                ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    管理者ダッシュボード                             │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │   │
│  │  │コンテンツ│ │ユーザー │ │  INFO   │ │SCHEDULE │ │  VIDEO  │   │   │
│  │  │  管理   │ │  管理   │ │  管理   │ │  管理   │ │  管理   │   │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
│  │   Better Auth   │  │     Stripe      │  │   Supabase DB   │        │
│  │   (認証基盤)     │  │   (決済基盤)     │  │  (データベース)   │        │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘        │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    横断的機能                                     │   │
│  │  ┌─────────────────┐  ┌─────────────────┐                       │   │
│  │  │ 多言語対応(i18n) │  │  ダークモード    │                       │   │
│  │  │  日本語/英語     │  │  next-themes    │                       │   │
│  │  └─────────────────┘  └─────────────────┘                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

【範囲外】
- モバイルアプリ開発
- 外部SNS連携（将来検討）
- チャットボット機能
```

---

## 2. 業務要件（一覧）

本システムは以下の業務を実現するものとする。

| 管理番号 | 業務 | 説明 | 実施者 | システム化対象 |
|---------|------|------|--------|--------------|
| **BR-01** | 会員登録 | 新規ユーザーがWebサイトから会員登録を行う。規約同意→プラン選択→アカウント作成→決済→プロフィール入力の流れ | 一般ユーザー | ○ |
| **BR-02** | ログイン/ログアウト | 会員がメールアドレスとパスワードでログイン・ログアウトを行う | 会員 | ○ |
| **BR-03** | コンテンツ閲覧（公開） | 誰でもお知らせ、スケジュール、動画、ブログの公開コンテンツを閲覧できる | 全ユーザー | ○ |
| **BR-04** | コンテンツ閲覧（会員限定） | 会員のみが会員限定のブログ、動画、ニュースレターを閲覧できる | 会員 | ○ |
| **BR-05** | マイページ確認 | 会員が自身のプロフィール、プラン情報、会員証を確認できる | 会員 | ○ |
| **BR-06** | プロフィール編集 | 会員が自身の氏名、住所、連絡先情報を編集できる | 会員 | ○ |
| **BR-07** | サブスクリプション決済 | Stripeを通じて会費（月額/年額）の自動決済を行う | システム | ○ |
| **BR-08** | お知らせ管理 | 管理者がお知らせを作成・編集・削除・公開/非公開設定を行う | 管理者 | ○ |
| **BR-09** | スケジュール管理 | 管理者がイベントスケジュールを作成・編集・削除・公開/非公開設定を行う | 管理者 | ○ |
| **BR-10** | 動画管理 | 管理者が動画コンテンツを作成・編集・削除・公開/非公開・会員限定設定を行う | 管理者 | ○ |
| **BR-11** | ブログ管理 | 管理者がブログ記事を作成・編集・削除・公開/非公開・会員限定設定を行う | 管理者 | ○ |
| **BR-12** | ニュースレター管理 | 管理者が会報を作成・編集・削除・公開/非公開設定を行う | 管理者 | ○ |
| **BR-13** | ユーザー管理 | 管理者が会員一覧の確認、会員情報の編集、権限変更を行う | 管理者 | ○ |

---

## 3. 業務要件（フロー図）

### 3.1 会員登録フロー

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           会員登録フロー                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ユーザー        Webサイト          Better Auth      Stripe      DB     │
│     │               │                   │              │          │     │
│     │  サイト訪問    │                   │              │          │     │
│     │──────────────>│                   │              │          │     │
│     │               │                   │              │          │     │
│     │  /signup表示   │                   │              │          │     │
│     │<──────────────│                   │              │          │     │
│     │               │                   │              │          │     │
│     │  登録開始      │                   │              │          │     │
│     │──────────────>│                   │              │          │     │
│     │               │                   │              │          │     │
│     │  規約同意      │                   │              │          │     │
│     │──────────────>│ /register/terms   │              │          │     │
│     │               │                   │              │          │     │
│     │  プラン選択    │                   │              │          │     │
│     │──────────────>│ /register/plan    │              │          │     │
│     │               │                   │              │          │     │
│     │  アカウント作成 │                   │              │          │     │
│     │──────────────>│ /register/auth    │              │          │     │
│     │               │   認証リクエスト    │              │          │     │
│     │               │──────────────────>│              │          │     │
│     │               │                   │  ユーザー作成  │          │     │
│     │               │                   │─────────────────────────>│     │
│     │               │                   │              │          │     │
│     │  決済画面      │                   │              │          │     │
│     │──────────────>│ /register/payment │              │          │     │
│     │               │                   │ Checkout     │          │     │
│     │               │──────────────────────────────────>│          │     │
│     │               │                   │              │          │     │
│     │  決済完了      │                   │  Webhook     │          │     │
│     │               │<──────────────────────────────────│          │     │
│     │               │                   │              │ 会員作成  │     │
│     │               │─────────────────────────────────────────────>│     │
│     │               │                   │              │          │     │
│     │  プロフィール入力│                   │              │          │     │
│     │──────────────>│ /profile/complete │              │          │     │
│     │               │                   │              │ 更新     │     │
│     │               │─────────────────────────────────────────────>│     │
│     │               │                   │              │          │     │
│     │  登録完了      │                   │              │          │     │
│     │<──────────────│ /mypage           │              │          │     │
│     │               │                   │              │          │     │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 コンテンツ閲覧フロー

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         コンテンツ閲覧フロー                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ユーザー                  Webサイト                       DB            │
│     │                         │                            │            │
│     │   コンテンツページアクセス  │                            │            │
│     │────────────────────────>│                            │            │
│     │                         │                            │            │
│     │                         │  コンテンツ取得              │            │
│     │                         │───────────────────────────>│            │
│     │                         │                            │            │
│     │                         │  isMemberOnly チェック       │            │
│     │                         │<───────────────────────────│            │
│     │                         │                            │            │
│     │                    ┌────┴────┐                       │            │
│     │                    │会員限定？│                       │            │
│     │                    └────┬────┘                       │            │
│     │                         │                            │            │
│     │              ┌──────────┼──────────┐                 │            │
│     │              │ No       │          │ Yes             │            │
│     │              ▼          │          ▼                 │            │
│     │         公開コンテンツ   │     ログイン確認             │            │
│     │         そのまま表示    │          │                  │            │
│     │              │          │     ┌────┴────┐            │            │
│     │              │          │     │ログイン済？│            │            │
│     │              │          │     └────┬────┘            │            │
│     │              │          │          │                 │            │
│     │              │          │    Yes   │   No            │            │
│     │              │          │    ┌─────┴─────┐           │            │
│     │              │          │    ▼           ▼           │            │
│     │              │          │  コンテンツ表示  ログインページへ │            │
│     │              │          │                リダイレクト   │            │
│     │              ▼          │                            │            │
│     │   コンテンツ表示         │                            │            │
│     │<────────────────────────│                            │            │
│     │                         │                            │            │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 管理者コンテンツ管理フロー

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      管理者コンテンツ管理フロー                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  管理者          管理画面              認証チェック           DB          │
│     │               │                     │                 │           │
│     │  管理画面アクセス│                     │                 │           │
│     │──────────────>│                     │                 │           │
│     │               │   権限確認           │                 │           │
│     │               │───────────────────>│                 │           │
│     │               │                     │                 │           │
│     │               │   role=admin?       │                 │           │
│     │               │<───────────────────│                 │           │
│     │               │                     │                 │           │
│     │  ダッシュボード │                     │                 │           │
│     │<──────────────│                     │                 │           │
│     │               │                     │                 │           │
│     │  コンテンツ作成 │                     │                 │           │
│     │──────────────>│                     │                 │           │
│     │               │                     │                 │           │
│     │  フォーム入力   │                     │                 │           │
│     │──────────────>│                     │                 │           │
│     │               │                     │                 │           │
│     │  保存         │                     │                 │           │
│     │──────────────>│                     │     INSERT      │           │
│     │               │──────────────────────────────────────>│           │
│     │               │                     │                 │           │
│     │  完了通知      │                     │                 │           │
│     │<──────────────│                     │                 │           │
│     │               │                     │                 │           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 機能要件（一覧）

### 4.1 公開ページ機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-01** | ホームページ | ヒーロー画像、カルーセル、お知らせ・スケジュール・動画の最新情報を表示。PC/スマホ対応（レスポンシブ） | UI | BR-03 |
| **FR-02** | お知らせ一覧 | 公開中のお知らせを日付降順で一覧表示。会員限定コンテンツにはバッジ表示 | UI | BR-03, BR-04 |
| **FR-03** | お知らせ詳細 | お知らせの詳細内容を表示。会員限定の場合は認証チェック | UI | BR-03, BR-04 |
| **FR-04** | スケジュール一覧 | 公開中のイベントスケジュールを日付順で一覧表示 | UI | BR-03 |
| **FR-05** | スケジュール詳細 | イベントの詳細情報を表示 | UI | BR-03 |
| **FR-06** | 動画一覧 | 公開中の動画をサムネイル付きで一覧表示 | UI | BR-03, BR-04 |
| **FR-07** | 動画詳細 | YouTube埋め込みによる動画再生。会員限定の場合は認証チェック | UI | BR-03, BR-04 |
| **FR-08** | ブログ一覧 | 公開中のブログ記事を一覧表示 | UI | BR-03, BR-04 |
| **FR-09** | ブログ詳細 | ブログ記事の本文を表示。会員限定の場合は認証チェック | UI | BR-03, BR-04 |
| **FR-10** | ニュースレター一覧 | 公開中の会報を一覧表示（会員限定） | UI | BR-04 |
| **FR-11** | ニュースレター詳細 | 会報の本文・PDFを表示（会員限定） | UI | BR-04 |
| **FR-12** | サポーターズ紹介 | サポーターズクラブの紹介ページ | UI | BR-03 |
| **FR-13** | プロフィール一覧 | メンバープロフィールの一覧表示 | UI | BR-03 |

### 4.2 認証機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-20** | ログインページ | メールアドレス・パスワードによるログインフォーム | UI | BR-02 |
| **FR-21** | 会員登録案内ページ | サービス説明、会費情報、登録への誘導 | UI | BR-01 |
| **FR-22** | 規約同意ページ | 会員規約の表示と同意チェック | UI | BR-01 |
| **FR-23** | プラン選択ページ | 会員プラン（年会費）の選択 | UI | BR-01 |
| **FR-24** | アカウント作成ページ | 名前、メールアドレス、パスワードの入力フォーム | UI | BR-01 |
| **FR-25** | 決済ページ | Stripe Checkoutへのリダイレクト | UI/バック | BR-01, BR-07 |
| **FR-26** | 決済成功ページ | 決済完了の通知とプロフィール入力への誘導 | UI | BR-01 |
| **FR-27** | 認証処理 | Better Authによるメール/パスワード認証 | バック | BR-01, BR-02 |
| **FR-28** | セッション管理 | ログインセッションの管理、自動ログアウト | バック | BR-02 |

### 4.3 会員専用機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-30** | マイページ | 会員情報、プラン、会員証の表示 | UI | BR-05 |
| **FR-31** | プロフィール編集 | 氏名、住所、連絡先の編集フォーム | UI | BR-06 |
| **FR-32** | プロフィール完了ページ | 初回登録時の詳細情報入力フォーム | UI | BR-01, BR-06 |
| **FR-33** | 会員限定コンテンツ表示 | 会員限定バッジ、アクセス制御 | UI/バック | BR-04 |
| **FR-34** | 会員認証チェック | ログイン状態・会員ステータスの確認 | バック | BR-04 |

### 4.4 決済機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-40** | Stripe Checkout | Stripe決済画面へのリダイレクト | バック | BR-07 |
| **FR-41** | Stripe Webhook | 決済完了イベントの受信と処理 | バック | BR-07 |
| **FR-42** | サブスクリプション管理 | 月額課金の自動更新 | バック | BR-07 |
| **FR-43** | 顧客ID保存 | Stripe Customer IDのDB保存 | バック | BR-07 |

### 4.5 管理者機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-50** | 管理者ログイン | 管理者専用ログインページ | UI | BR-08-13 |
| **FR-51** | 管理者ダッシュボード | 管理機能へのナビゲーション | UI | BR-08-13 |
| **FR-52** | お知らせ管理 | 一覧表示、新規作成、編集、削除 | UI/バック | BR-08 |
| **FR-53** | スケジュール管理 | 一覧表示、新規作成、編集、削除 | UI/バック | BR-09 |
| **FR-54** | 動画管理 | 一覧表示、新規作成、編集、削除、会員限定設定 | UI/バック | BR-10 |
| **FR-55** | ブログ管理 | 一覧表示、新規作成、編集、削除、会員限定設定 | UI/バック | BR-11 |
| **FR-56** | ニュースレター管理 | 一覧表示、新規作成、編集、削除 | UI/バック | BR-12 |
| **FR-57** | ユーザー管理 | 会員一覧、詳細表示、編集 | UI/バック | BR-13 |
| **FR-58** | 管理者権限チェック | role=admin の確認 | バック | BR-08-13 |
| **FR-59** | 画像アップロード | S3/Supabase Storageへの画像保存 | バック | BR-08-12 |

### 4.6 横断的機能

| 管理番号 | 機能 | 説明 | 分類 | 対応業務要件 |
|---------|------|------|------|------------|
| **FR-60** | 多言語対応（i18n） | 日本語・英語の切り替え表示。next-intlによる国際化対応 | UI | BR-03, BR-04 |
| **FR-61** | ダークモード | next-themesによるライト/ダークテーマの切り替え | UI | - |
| **FR-62** | サブスクライブページ | サブスクリプション申込ページ | UI | BR-01, BR-07 |
| **FR-63** | 決済キャンセルページ | 決済キャンセル・失敗時の案内ページ | UI | BR-07 |

---

## 5. 補足：機能と配置イメージ

### 5.1 システム構成図

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              クライアント                                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Webブラウザ（PC/スマホ）                        │   │
│  │                    Chrome / Safari / Edge                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HTTPS
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            Vercel (ホスティング)                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      Next.js 15 (App Router)                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │   │
│  │  │ 公開ページ   │  │ 会員ページ   │  │ 管理者ダッシュボード     │  │   │
│  │  │ (main)     │  │ (auth)      │  │ (admin)                │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────────────────┘  │   │
│  │                                                                  │   │
│  │  ┌─────────────────────────────────────────────────────────┐    │   │
│  │  │                    API Routes                            │    │   │
│  │  │  /api/auth/*  (Better Auth)                              │    │   │
│  │  │  /api/auth/stripe/webhook  (Stripe Webhook)              │    │   │
│  │  └─────────────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
          │                    │                    │
          │                    │                    │
          ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│   Supabase      │  │     Stripe      │  │   AWS S3 /      │
│   (PostgreSQL)  │  │   (決済基盤)     │  │   Supabase      │
│                 │  │                 │  │   Storage       │
│  - users        │  │  - Checkout     │  │                 │
│  - members      │  │  - Subscription │  │  - 画像保存      │
│  - member_plans │  │  - Customer     │  │  - PDFファイル   │
│  - informations │  │  - Webhook      │  │                 │
│  - schedules    │  │                 │  │                 │
│  - videos       │  │                 │  │                 │
│  - blogs        │  │                 │  │                 │
│  - newsletters  │  │                 │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

### 5.2 画面遷移図

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              公開ページ                                   │
│                                                                         │
│  ┌─────┐    ┌─────────┐    ┌──────────┐    ┌───────┐    ┌──────┐      │
│  │HOME │───>│INFO一覧  │───>│INFO詳細   │    │VIDEO  │───>│VIDEO │      │
│  │     │    │         │    │          │    │一覧   │    │詳細  │      │
│  └──┬──┘    └─────────┘    └──────────┘    └───────┘    └──────┘      │
│     │                                                                   │
│     │       ┌──────────┐    ┌──────────┐    ┌───────┐    ┌──────┐      │
│     └──────>│SCHEDULE  │───>│SCHEDULE  │    │BLOG   │───>│BLOG  │      │
│             │一覧       │    │詳細       │    │一覧   │    │詳細  │      │
│             └──────────┘    └──────────┘    └───────┘    └──────┘      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ ログイン
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              認証フロー                                   │
│                                                                         │
│  ┌───────┐    ┌───────┐    ┌───────┐    ┌───────┐    ┌────────┐       │
│  │signup │───>│terms  │───>│plan   │───>│auth   │───>│payment │       │
│  │       │    │       │    │       │    │       │    │        │       │
│  └───────┘    └───────┘    └───────┘    └───────┘    └───┬────┘       │
│                                                          │             │
│                                              ┌───────────┘             │
│                                              ▼                         │
│  ┌───────┐                              ┌────────┐    ┌───────────┐   │
│  │login  │─────────────────────────────>│mypage  │───>│profile    │   │
│  │       │                              │        │    │/complete  │   │
│  └───────┘                              └────────┘    └───────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ 管理者のみ
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           管理者ダッシュボード                             │
│                                                                         │
│  ┌───────────┐                                                          │
│  │ dashboard │                                                          │
│  └─────┬─────┘                                                          │
│        │                                                                │
│        ├──> informations ──> [id] (編集) / new (新規作成)                │
│        ├──> schedules ────> [id] (編集) / new (新規作成)                 │
│        ├──> videos ───────> [id] (編集) / new (新規作成)                 │
│        ├──> blogs ────────> [id] (編集) / new (新規作成)                 │
│        ├──> newsletters ──> [id] (編集) / new (新規作成)                 │
│        └──> accounts ─────> [id] (詳細) / [id]/edit (編集)              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.3 データベース構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           データベース構成                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────┐      ┌─────────────────┐      ┌────────────────┐  │
│  │     users       │      │    members      │      │ member_plans   │  │
│  │ (Better Auth)   │1────1│                 │N────1│                │  │
│  ├─────────────────┤      ├─────────────────┤      ├────────────────┤  │
│  │ id              │      │ id              │      │ id             │  │
│  │ name            │      │ userId (FK)     │      │ planCode       │  │
│  │ email           │      │ email           │      │ planName       │  │
│  │ emailVerified   │      │ lastName        │      │ displayName    │  │
│  │ image           │      │ firstName       │      │ price          │  │
│  │ stripeCustomerId│      │ postalCode      │      │ hierarchyLevel │  │
│  │ createdAt       │      │ prefecture      │      │ stripePriceId  │  │
│  │ updatedAt       │      │ city, address   │      │ isActive       │  │
│  └────────┬────────┘      │ phoneNumber     │      └────────────────┘  │
│           │               │ planId (FK)     │                          │
│           │               │ role            │                          │
│           │               │ status          │                          │
│           │               │ paymentStatus   │                          │
│           │               └─────────────────┘                          │
│           │                                                            │
│           │ 1:N  (Better Auth 関連テーブル)                             │
│           ▼                                                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                Better Auth 関連テーブル                           │   │
│  ├──────────────┬──────────────┬──────────────┬──────────────┬─────┤   │
│  │  sessions    │  accounts    │verifications │subscriptions │     │   │
│  │              │              │              │(Stripe)      │     │   │
│  ├──────────────┼──────────────┼──────────────┼──────────────┼─────┤   │
│  │id            │id            │id            │id            │     │   │
│  │expiresAt     │accountId     │identifier    │plan          │     │   │
│  │token         │providerId    │value         │referenceId   │     │   │
│  │createdAt     │userId (FK)   │expiresAt     │stripeCustomer│     │   │
│  │updatedAt     │accessToken   │createdAt     │stripeSubscri-│     │   │
│  │ipAddress     │refreshToken  │updatedAt     │ ptionId      │     │   │
│  │userAgent     │idToken       │              │status        │     │   │
│  │userId (FK)   │createdAt     │              │periodStart   │     │   │
│  │              │updatedAt     │              │periodEnd     │     │   │
│  └──────────────┴──────────────┴──────────────┴──────────────┴─────┘   │
│                                   │                                     │
│                                   │ 1:N (createdBy/authorId)           │
│                                   ▼                                     │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      コンテンツテーブル群                          │   │
│  ├──────────────┬──────────────┬──────────────┬──────────────┬─────┤   │
│  │informations  │  schedules   │   videos     │    blogs     │news-│   │
│  │              │              │              │              │letters  │
│  ├──────────────┼──────────────┼──────────────┼──────────────┼─────┤   │
│  │id            │id            │id            │id            │id   │   │
│  │date          │title         │title         │title         │issueNumber│
│  │title         │content       │videoDate     │excerpt       │title│   │
│  │content       │eventDate     │videoUrl      │content       │content  │
│  │url           │imageUrl      │thumbnailUrl  │thumbnailUrl  │pdfUrl   │
│  │imageUrl      │published     │published     │published     │published│
│  │published     │isMemberOnly  │isMemberOnly  │isMemberOnly  │isMember │
│  │isMemberOnly  │viewCount     │viewCount     │viewCount     │viewCount│
│  │createdBy     │authorId      │authorId      │authorId      │authorId │
│  │createdAt     │createdAt     │createdAt     │createdAt     │createdAt│
│  └──────────────┴──────────────┴──────────────┴──────────────┴─────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 非機能要件（一覧）

| 非機能要件 | 管理番号 | 個別定義対象 | 内容 |
|-----------|---------|------------|------|
| 可用性（信頼性） | NR-01 | ○ | システムの利用可能率についての方針を定義する。Vercelの稼働率に準拠。 |
| 性能 | NR-02 | ○ | システムが達成すべき性能について定義する。表示速度、応答速度。 |
| セキュリティー | NR-03 | ○ | システムが有すべきセキュリティーについて定義する。 |
| 移行性 | NR-04 | ○ | 既存システムからの移行について定義する（該当なし：新規構築）。 |
| 保守性 | NR-05 | - | 可能な限りメンテナンスフリーなクラウド環境を利用する。 |
| プロジェクト上の留意事項 | NR-06 | ○ | 対応ブラウザ、利用サービス等について定義する。 |
| 環境・エコロジー | NR-07 | - | 利用するクラウドサービスの環境配慮に依存。 |
| アクセシビリティー | NR-08 | - | 基本的なアクセシビリティに配慮する。 |
| 操作性（使いやすさ） | NR-09 | - | シンプルで直感的なUIを提供する。 |
| 方式 | NR-10 | - | Next.js App Router + Better Auth + Stripe + Supabase を採用。 |
| 運用性 | NR-11 | - | Vercelの自動デプロイを利用。 |

---

### 6.1 可用性

| 項目 | 内容 |
|------|------|
| **管理番号** | NR-01 |
| **基本要件** | ・24時間365日の稼働を目標とする<br>・99.9%以上の稼働率を期待する（Vercel SLA準拠） |
| **理由** | ・会員がいつでもコンテンツにアクセスできることが本システムの目的であるため |
| **補足** | ・Vercel、Supabase、Stripeの稼働率に依存<br>・計画メンテナンス時はサイト上で事前告知<br>・障害発生時はVercelのステータスページを確認 |

---

### 6.2 性能

| 項目 | 内容 |
|------|------|
| **管理番号** | NR-02 |
| **基本要件** | ・静的ページは平均1秒以内で表示できること<br>・動的ページは平均2秒以内で表示できること<br>・同時接続100ユーザー程度を想定 |
| **理由** | ・ユーザーの離脱を防止するため |
| **補足** | ・Next.jsのSSG/ISRを活用し、可能な限り静的配信<br>・画像はNext.js Image Optimizationを使用<br>・Vercel Edge Networkによるキャッシュを活用 |

---

### 6.3 セキュリティー

| 項目 | 内容 |
|------|------|
| **管理番号** | NR-03 |
| **基本要件** | **Webシステムとしてのセキュリティー**<br>・HTTPS通信の強制<br>・XSS、CSRF、SQLインジェクション対策<br>・パスワードのハッシュ化（Better Auth標準）<br><br>**認証・認可**<br>・Better Authによるセッション管理<br>・HTTPOnly Cookieの使用<br>・会員限定コンテンツのアクセス制御<br><br>**決済セキュリティー**<br>・Stripe PCI DSS準拠<br>・Webhook署名検証 |
| **理由** | ・会員の個人情報と決済情報を安全に管理するため |
| **補足** | ・環境変数による機密情報管理<br>・Supabase Row Level Securityの活用を検討<br>・定期的なセキュリティアップデートの適用 |

---

### 6.4 移行性

| 項目 | 内容 |
|------|------|
| **管理番号** | NR-04 |
| **基本要件** | **新規構築のため、既存システムからの移行は発生しない**<br><br>■リリース時<br>・本番環境へのデプロイはVercelの自動デプロイを使用<br>・初期データ（プランマスタ等）はマイグレーションスクリプトで投入<br><br>■データ<br>・移行すべきデータは存在しない |
| **補足** | ・開発環境、本番環境の分離<br>・環境変数による環境切り替え |

---

### 6.5 プロジェクト上の留意事項

| 項目 | 内容 |
|------|------|
| **管理番号** | NR-06 |
| **基本要件** | **■対応ブラウザ**<br>・PC: Google Chrome（最新版）、Safari（最新版）、Edge（最新版）<br>・スマホ: Google Chrome（最新版）、Safari（最新版）<br><br>**■利用を前提とするサービス・ツール**<br>・Vercel（ホスティング）<br>・Supabase（PostgreSQL データベース）<br>・Better Auth（認証）<br>・Stripe（決済）<br>・AWS S3 または Supabase Storage（ファイルストレージ）<br><br>**■技術スタック**<br>・Next.js 15（App Router）<br>・React 19<br>・TypeScript<br>・Tailwind CSS<br>・Drizzle ORM<br>・shadcn/ui<br>・next-intl（多言語対応）<br>・next-themes（ダークモード）<br><br>**■テスト環境**<br>・Vitest（ユニットテスト）<br>・Playwright（E2Eテスト）<br>・Storybook（UIコンポーネントカタログ） |
| **補足** | ・OSSライブラリのライセンスに留意<br>・主要な技術を採用し、継続性を確保<br>・ダークモード対応（ライト/ダークテーマ切り替え） |

---

## 更新履歴

| 日付 | バージョン | 内容 | 作成者 |
|------|-----------|------|--------|
| 2025-12-09 | 1.0 | 初版作成 | - |
| 2025-12-09 | 1.1 | レビュー指摘反映：多言語対応(i18n)・ダークモード追加、Better Auth関連テーブル追加、テスト環境追加、カラム名修正(issueNumber, url, viewCount) | - |

---

## 関連ドキュメント

- [ページ構成一覧](./pages-overview.md)
- [URL設計](./url-design.md)
- [データベース設計書](./database-design-sql.md)
- [アカウント設計](./account-design.md)
- [アクセス制御設計](./access-control-design.md)
- API設計書（今後作成予定）
- テスト仕様書（今後作成予定）
