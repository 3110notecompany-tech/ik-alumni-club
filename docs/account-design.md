# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**ä½œæˆæ—¥**: 2025-10-30
**æœ€çµ‚æ›´æ–°**: 2025-10-30
**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **: IK ALUMNI CGT ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‚ºã‚¯ãƒ©ãƒ–ä¼šå“¡ã‚µã‚¤ãƒˆ
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 3.1ï¼ˆæ–°ç™»éŒ²ãƒ•ãƒ­ãƒ¼ - Stripeæ±ºæ¸ˆã¯å°†æ¥å¯¾å¿œï¼‰

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ ](#ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ )
3. [èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ](#èªè¨¼ã‚·ã‚¹ãƒ†ãƒ )
4. [ä¼šå“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ](#ä¼šå“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ )
5. [æ¨©é™è¨­è¨ˆ](#æ¨©é™è¨­è¨ˆ)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è©³ç´°](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è©³ç´°)
7. [èªè¨¼ãƒ•ãƒ­ãƒ¼](#èªè¨¼ãƒ•ãƒ­ãƒ¼)
8. [ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼](#ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ)
10. [å®Ÿè£…çŠ¶æ³](#å®Ÿè£…çŠ¶æ³)

---

## æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„

IK ALUMNI CGT ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‚ºã‚¯ãƒ©ãƒ–ã®ä¼šå“¡å‘ã‘ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ãŸã‚ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚èªè¨¼ã¨ä¼šå“¡æƒ…å ±ã‚’åˆ†é›¢ã—ãŸ2å±¤æ§‹é€ ã«ã‚ˆã‚Šã€æŸ”è»Ÿãªæ¨©é™ç®¡ç†ã¨æ‹¡å¼µæ€§ã‚’å®Ÿç¾ã™ã‚‹ã€‚

### è¨­è¨ˆã®ç‰¹å¾´

- **2å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: èªè¨¼å±¤(Better Auth) + ä¼šå“¡ç®¡ç†å±¤(ç‹¬è‡ªå®Ÿè£…)
- **æ®µéšçš„ãªæƒ…å ±åé›†**: æœ€å°é™ã®æƒ…å ±ã§èªè¨¼ â†’ è©³ç´°æƒ…å ±ã¯ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã§åé›†
- **ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: admin / member ã«ã‚ˆã‚‹æ¨©é™ç®¡ç†
- **ãƒ—ãƒ©ãƒ³ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶å¾¡**: Individual / Business / Platinum ã«ã‚ˆã‚‹éšå±¤çš„ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ï¼ˆè¨­è¨ˆæ›¸ã«å®šç¾©ã€æœªå®Ÿè£…ï¼‰

### æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›®çš„

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã‚’æ˜ç¢ºã«ã—ã¾ã™:

1. **ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³**: å®Ÿéš›ã«å‹•ä½œã—ã¦ã„ã‚‹æ©Ÿèƒ½ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰
2. **è¨­è¨ˆæ›¸ã¨ã®å¯¾å¿œ**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å®Œå…¨ãªè¨­è¨ˆï¼ˆğŸ”œ æœªå®Ÿè£…ï¼‰
3. **å®Ÿè£…ã¨è¨­è¨ˆã®ã‚®ãƒ£ãƒƒãƒ—**: ä½•ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¦ã€ä½•ãŒæœªå®Ÿè£…ã‹
4. **ä»Šå¾Œã®å®Ÿè£…æ–¹é‡**: è¨­è¨ˆæ›¸ã«åŸºã¥ãæ‹¡å¼µè¨ˆç”»

**é‡è¦ãªèªè­˜**:
- ç¾åœ¨ã® `members` ãƒ†ãƒ¼ãƒ–ãƒ«ã¯æœ€å°é™ã®å®Ÿè£…ï¼ˆuserId + role ã®ã¿ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã«ã¯å®Œå…¨ãªä¼šå“¡æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- å°†æ¥çš„ã«è©³ç´°ãªä¼šå“¡æƒ…å ±ï¼ˆæ°åã€ä½æ‰€ã€é›»è©±ç•ªå·ç­‰ï¼‰ã¨ãƒ—ãƒ©ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ äºˆå®š

---

## ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ§‹é€ 

### ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³ï¼ˆå®Œå…¨ç‰ˆè¨­è¨ˆ - Stripeæ±ºæ¸ˆã¯å°†æ¥å¯¾å¿œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èªè¨¼å±¤ (Better Auth)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users   â”‚  â”‚ sessions â”‚  â”‚ accounts â”‚  â”‚verifications â”‚   â”‚
â”‚  â”‚  - id    â”‚  â”‚          â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚  - name  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â”‚  - email â”‚  â”‚          â”‚  â”‚          â”‚  â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ 1:1
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ä¼šå“¡ç®¡ç†å±¤ (ç‹¬è‡ªå®Ÿè£…)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ members (å®Œå…¨ç‰ˆ)         â”‚N:1 â”‚ member_plans     â”‚ğŸ”œæœªå®Ÿè£…   â”‚
â”‚  â”‚ âœ… - id                 â”‚â”€â”€â”€â†’â”‚  - id            â”‚           â”‚
â”‚  â”‚ âœ… - userId             â”‚    â”‚  - planCode      â”‚           â”‚
â”‚  â”‚ âœ… - role               â”‚    â”‚  - price         â”‚           â”‚
â”‚  â”‚ ğŸ”œ - lastName           â”‚    â”‚  - hierarchyLevelâ”‚           â”‚
â”‚  â”‚ ğŸ”œ - firstName          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”‚ ğŸ”œ - address...         â”‚                                    â”‚
â”‚  â”‚ ğŸ”œ - planId             â”‚                                    â”‚
â”‚  â”‚ ğŸ”œ - status             â”‚                                    â”‚
â”‚  â”‚ ğŸ”œ - profileCompleted   â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ 1:N
                        â”‚ (createdBy)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å±¤ (ä½œæˆè€…æƒ…å ±)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ blogs    â”‚  â”‚ videos   â”‚  â”‚schedules â”‚  â”‚newslettersâ”‚ ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‡¡ä¾‹:
âœ… å®Ÿè£…æ¸ˆã¿
ğŸ”œ è¨­è¨ˆæ›¸ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒæœªå®Ÿè£…

ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ãƒ­ãƒ¼ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚º - æ±ºæ¸ˆãªã—ï¼‰:
1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ â†’ status: "pending_profile"ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›å®Œäº† â†’ status: "active" â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

å°†æ¥ã®æ‹¡å¼µï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚º - Stripeæ±ºæ¸ˆçµ±åˆï¼‰:
1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ â†’ status: "pending_payment"
2. Stripeæ±ºæ¸ˆå®Œäº† â†’ status: "pending_profile"
3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›å®Œäº† â†’ status: "active" â†’ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### 2å±¤æ§‹é€ ã®ç†ç”±

| å±¤ | è²¬ä»» | å®Ÿè£… |
|---|------|------|
| **èªè¨¼å±¤** | ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æº | Better Auth |
| **ä¼šå“¡ç®¡ç†å±¤** | æ¨©é™ç®¡ç†ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ä¼šå“¡å±æ€§ç®¡ç† | ç‹¬è‡ªå®Ÿè£… |

**ãƒ¡ãƒªãƒƒãƒˆ**:
- èªè¨¼ã®è²¬ä»»ã‚’å°‚é–€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å§”è­²
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŸ”è»Ÿã«æ‹¡å¼µå¯èƒ½
- å°†æ¥çš„ãªãƒ—ãƒ©ãƒ³æ©Ÿèƒ½ã®æ‹¡å¼µã«å¯¾å¿œ

---

## èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### ä½¿ç”¨æŠ€è¡“

**Better Auth**: æ¬¡ä¸–ä»£ã®èªè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- TypeScriptå®Œå…¨å¯¾å¿œ
- Drizzle ORMçµ±åˆ
- Email/Passwordèªè¨¼
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- CSRFä¿è­·

### èªè¨¼ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ

#### 1. users ãƒ†ãƒ¼ãƒ–ãƒ«

**ç›®çš„**: èªè¨¼ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | text | PK | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆBetter Authç”Ÿæˆï¼‰ |
| name | text | NOT NULL | è¡¨ç¤ºå |
| email | text | NOT NULL, UNIQUE | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| emailVerified | boolean | NOT NULL, DEFAULT false | ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ãƒ•ãƒ©ã‚° |
| image | text | NULL | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL |
| createdAt | timestamp | NOT NULL, DEFAULT NOW() | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | NOT NULL, DEFAULT NOW() | æ›´æ–°æ—¥æ™‚ |

**ç‰¹å¾´**:
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«(accounts)ã§ç®¡ç†
- æœ€å°é™ã®æƒ…å ±ã®ã¿ä¿æŒ
- Better AuthãŒè‡ªå‹•ç®¡ç†

#### 2. sessions ãƒ†ãƒ¼ãƒ–ãƒ«

**ç›®çš„**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | text | PK | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID |
| expiresAt | timestamp | NOT NULL | æœ‰åŠ¹æœŸé™ |
| token | text | NOT NULL, UNIQUE | ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ |
| createdAt | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |
| ipAddress | text | NULL | IPã‚¢ãƒ‰ãƒ¬ã‚¹ |
| userAgent | text | NULL | User Agent |
| userId | text | FK, NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |

**å¤–éƒ¨ã‚­ãƒ¼**:
- `userId` â†’ `users.id` (onDelete: CASCADE)

**ç‰¹å¾´**:
- ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã®è¨˜éŒ²
- è‡ªå‹•æœŸé™åˆ‡ã‚Œ

#### 3. accounts ãƒ†ãƒ¼ãƒ–ãƒ«

**ç›®çš„**: èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã”ã¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | text | PK | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID |
| accountId | text | NOT NULL | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å†…ã®ID |
| providerId | text | NOT NULL | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼IDï¼ˆcredentialç­‰ï¼‰ |
| userId | text | FK, NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| accessToken | text | NULL | ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆOAuthç”¨ï¼‰ |
| refreshToken | text | NULL | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ |
| idToken | text | NULL | IDãƒˆãƒ¼ã‚¯ãƒ³ |
| accessTokenExpiresAt | timestamp | NULL | ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ |
| refreshTokenExpiresAt | timestamp | NULL | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ |
| scope | text | NULL | ã‚¹ã‚³ãƒ¼ãƒ— |
| password | text | NULL | ãƒãƒƒã‚·ãƒ¥åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| createdAt | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**å¤–éƒ¨ã‚­ãƒ¼**:
- `userId` â†’ `users.id` (onDelete: CASCADE)

**ç‰¹å¾´**:
- Email/Passwordèªè¨¼ã®å ´åˆã€`password`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜
- å°†æ¥çš„ãªOAuthé€£æºã«ã‚‚å¯¾å¿œå¯èƒ½

#### 4. verifications ãƒ†ãƒ¼ãƒ–ãƒ«

**ç›®çš„**: ãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | text | PK | æ¤œè¨¼ID |
| identifier | text | NOT NULL | è­˜åˆ¥å­ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰ï¼‰ |
| value | text | NOT NULL | ãƒˆãƒ¼ã‚¯ãƒ³å€¤ |
| expiresAt | timestamp | NOT NULL | æœ‰åŠ¹æœŸé™ |
| createdAt | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ç”¨é€”**:
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- æ™‚é™ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

---

## ä¼šå“¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾©

ä¼šå“¡ç™»éŒ²ã‹ã‚‰å®Œå…¨ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã‚‹ã¾ã§ã€è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµŒã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆç¾åœ¨ - æ±ºæ¸ˆãªã—ï¼‰**:
```typescript
type MemberStatus =
  | "pending_profile"    // è¿½åŠ æƒ…å ±å…¥åŠ›å¾…ã¡ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç›´å¾Œï¼‰
  | "active"             // å®Œå…¨ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼šå“¡ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›å®Œäº†ï¼‰
  | "inactive"           // é€€ä¼šæ¸ˆã¿
```

**ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå°†æ¥ - Stripeæ±ºæ¸ˆçµ±åˆå¾Œï¼‰**:
```typescript
type MemberStatus =
  | "pending_payment"    // æ”¯æ‰•ã„å¾…ã¡ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç›´å¾Œï¼‰ğŸ”œæœªå®Ÿè£…
  | "pending_profile"    // è¿½åŠ æƒ…å ±å…¥åŠ›å¾…ã¡ï¼ˆæ”¯æ‰•ã„å®Œäº†å¾Œï¼‰
  | "active"             // å®Œå…¨ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼šå“¡ï¼ˆå…¨ã¦å®Œäº†ï¼‰
  | "inactive"           // é€€ä¼šæ¸ˆã¿
```

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»å›³

**ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆç¾åœ¨ - æ±ºæ¸ˆãªã—ï¼‰**:
```
æ–°è¦ç™»éŒ²
  â†“
pending_profileï¼ˆè¿½åŠ æƒ…å ±å…¥åŠ›å¾…ã¡ï¼‰
  â†“ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œæˆ
activeï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼šå“¡ï¼‰
  â†“ é€€ä¼šå‡¦ç†
inactiveï¼ˆé€€ä¼šæ¸ˆã¿ï¼‰
```

**ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå°†æ¥ - Stripeæ±ºæ¸ˆçµ±åˆå¾Œï¼‰**:
```
æ–°è¦ç™»éŒ²
  â†“
pending_paymentï¼ˆæ”¯æ‰•ã„å¾…ã¡ï¼‰
  â†“ Stripeæ±ºæ¸ˆå®Œäº†
pending_profileï¼ˆè¿½åŠ æƒ…å ±å…¥åŠ›å¾…ã¡ï¼‰
  â†“ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œæˆ
activeï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¼šå“¡ï¼‰
  â†“ é€€ä¼šå‡¦ç†
inactiveï¼ˆé€€ä¼šæ¸ˆã¿ï¼‰
```

#### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

**ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆç¾åœ¨ - æ±ºæ¸ˆãªã—ï¼‰**:

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹ | ãƒã‚¤ãƒšãƒ¼ã‚¸ | ç®¡ç†ç”»é¢ï¼ˆadminï¼‰ |
|-----------|-----------------|----------|-----------------|
| pending_profile | âŒ ä¸å¯ | âš ï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ä¿ƒé€² | âœ… å¯èƒ½ |
| active | âœ… å¯èƒ½ï¼ˆãƒ—ãƒ©ãƒ³åˆ¥ï¼‰ | âœ… å¯èƒ½ | âœ… å¯èƒ½ |
| inactive | âŒ ä¸å¯ | âŒ ä¸å¯ | âœ… å¯èƒ½ |

**é‡è¦ãªãƒ«ãƒ¼ãƒ«**:
- è¿½åŠ æƒ…å ±æœªå…¥åŠ›ã®å ´åˆã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- `status === "active"` ã‹ã¤é©åˆ‡ãªãƒ—ãƒ©ãƒ³ã®å ´åˆã®ã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

**ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå°†æ¥ - Stripeæ±ºæ¸ˆçµ±åˆå¾Œï¼‰**:

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹ | ãƒã‚¤ãƒšãƒ¼ã‚¸ | ç®¡ç†ç”»é¢ï¼ˆadminï¼‰ |
|-----------|-----------------|----------|-----------------|
| pending_payment | âŒ ä¸å¯ | âš ï¸ æ”¯æ‰•ã„ä¿ƒé€²ç”»é¢ã®ã¿ | âœ… å¯èƒ½ |
| pending_profile | âŒ ä¸å¯ | âš ï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ä¿ƒé€² | âœ… å¯èƒ½ |
| active | âœ… å¯èƒ½ï¼ˆãƒ—ãƒ©ãƒ³åˆ¥ï¼‰ | âœ… å¯èƒ½ | âœ… å¯èƒ½ |
| inactive | âŒ ä¸å¯ | âŒ ä¸å¯ | âœ… å¯èƒ½ |

**è¿½åŠ ãƒ«ãƒ¼ãƒ«**:
- æ”¯æ‰•ã„æœªå®Œäº†ã®å ´åˆã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

### ä¼šå“¡ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ

#### members ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå®Œå…¨ç‰ˆè¨­è¨ˆ vs ç¾åœ¨ã®å®Ÿè£…ï¼‰

**ç›®çš„**: ä¼šå“¡ã®è©³ç´°æƒ…å ±ã¨æ¨©é™ç®¡ç†

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã§ã¯å®Œå…¨ãªä¼šå“¡æƒ…å ±ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ãŒã€ç¾åœ¨ã¯æœ€å°é™ã®å®Ÿè£…ã¨ãªã£ã¦ã„ã¾ã™ã€‚

##### ğŸ“˜ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã«åŸºã¥ãå®Œå…¨ãªã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|---------|-----|------|------|---------|
| **åŸºæœ¬æƒ…å ±** |||||
| id | UUID/text | PK | ä¼šå“¡ID | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆnanoidï¼‰ |
| userId | text | FK, NOT NULL, UNIQUE | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆBetter Authé€£æºï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ |
| email | VARCHAR(255) | UNIQUE, NOT NULL | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ | ğŸ”œ æœªå®Ÿè£…ï¼ˆusersã‹ã‚‰å–å¾—å¯èƒ½ï¼‰ |
| **æ°åæƒ…å ±** |||||
| lastName | VARCHAR(100) | NOT NULL | å§“ | ğŸ”œ æœªå®Ÿè£… |
| firstName | VARCHAR(100) | NOT NULL | å | ğŸ”œ æœªå®Ÿè£… |
| lastNameKana | VARCHAR(100) | NOT NULL | ã‚»ã‚¤ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰ | ğŸ”œ æœªå®Ÿè£… |
| firstNameKana | VARCHAR(100) | NOT NULL | ãƒ¡ã‚¤ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰ | ğŸ”œ æœªå®Ÿè£… |
| **ä½æ‰€æƒ…å ±** |||||
| postalCode | VARCHAR(8) | NOT NULL | éƒµä¾¿ç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—7æ¡ï¼‰ | ğŸ”œ æœªå®Ÿè£… |
| prefecture | VARCHAR(50) | NOT NULL | éƒ½é“åºœçœŒ | ğŸ”œ æœªå®Ÿè£… |
| city | VARCHAR(100) | NOT NULL | å¸‚åŒºç”ºæ‘ | ğŸ”œ æœªå®Ÿè£… |
| address | VARCHAR(255) | NOT NULL | ç”ºåç•ªåœ° | ğŸ”œ æœªå®Ÿè£… |
| building | VARCHAR(255) | NULL | å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå· | ğŸ”œ æœªå®Ÿè£… |
| **é€£çµ¡å…ˆæƒ…å ±** |||||
| phoneNumber | VARCHAR(20) | NOT NULL | é›»è©±ç•ªå· | ğŸ”œ æœªå®Ÿè£… |
| **ãƒ—ãƒ©ãƒ³ãƒ»æ¨©é™æƒ…å ±** |||||
| planId | INTEGER | FK, NOT NULL | ä¼šå“¡ãƒ—ãƒ©ãƒ³ID | ğŸ”œ æœªå®Ÿè£… |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'member' | æ¨©é™ï¼ˆadmin/memberï¼‰ | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆenumï¼‰ |
| **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†** |||||
| status | VARCHAR(20) | NOT NULL, DEFAULT 'pending_profile' | ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸ”œ æœªå®Ÿè£… |
| profileCompleted | BOOLEAN | NOT NULL, DEFAULT false | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›å®Œäº†ãƒ•ãƒ©ã‚° | ğŸ”œ æœªå®Ÿè£… |
| isActive | BOOLEAN | NOT NULL, DEFAULT true | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹çŠ¶æ…‹ï¼ˆé€€ä¼šç®¡ç†ï¼‰ | ğŸ”œ æœªå®Ÿè£… |
| **Stripeæ±ºæ¸ˆæƒ…å ±ï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼‰** |||||
| paymentCompleted | BOOLEAN | NULL | æ”¯æ‰•ã„å®Œäº†ãƒ•ãƒ©ã‚° | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| stripeCustomerId | VARCHAR(255) | NULL, UNIQUE | Stripe Customer ID | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| stripeSubscriptionId | VARCHAR(255) | NULL | Stripe Subscription ID | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| stripeSubscriptionStatus | VARCHAR(50) | NULL | Stripe ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| subscriptionStartedAt | TIMESTAMP | NULL | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–‹å§‹æ—¥æ™‚ | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| subscriptionEndsAt | TIMESTAMP | NULL | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çµ‚äº†æ—¥æ™‚ | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| lastPaymentAt | TIMESTAMP | NULL | æœ€å¾Œã®æ”¯æ‰•ã„æ—¥æ™‚ | ğŸ”œ æœªå®Ÿè£…ï¼ˆå°†æ¥å¯¾å¿œï¼‰ |
| **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿** |||||
| createdAt | TIMESTAMP WITH TIME ZONE | DEFAULT NOW() | ä½œæˆæ—¥æ™‚ | âœ… å®Ÿè£…æ¸ˆã¿ |
| updatedAt | TIMESTAMP WITH TIME ZONE | DEFAULT NOW() | æ›´æ–°æ—¥æ™‚ | âœ… å®Ÿè£…æ¸ˆã¿ |

##### ğŸ“ ç¾åœ¨å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚«ãƒ©ãƒ ï¼ˆç°¡æ˜“ç‰ˆï¼‰

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | text | PK | ä¼šå“¡IDï¼ˆnanoidç”Ÿæˆï¼‰ |
| userId | text | FK, NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| role | members_role | NOT NULL | æ¨©é™ï¼ˆadmin / memberï¼‰ |
| createdAt | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updatedAt | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**å¤–éƒ¨ã‚­ãƒ¼**:
- âœ… å®Ÿè£…æ¸ˆã¿: `userId` â†’ `users.id` (onDelete: CASCADE)
- ğŸ”œ æœªå®Ÿè£…: `planId` â†’ `member_plans.id` (onDelete: RESTRICT)

**enumå®šç¾©**:
```typescript
export const membersRole = ["admin", "member"] as const;
export const membersRoleEnum = pgEnum("members_role", membersRole);
```

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆè¨­è¨ˆæ›¸ã‚ˆã‚Šï¼‰**:
- `role` ã¯ 'admin' ã¾ãŸã¯ 'member' ã®ã¿è¨±å¯ï¼ˆCHECKåˆ¶ç´„ï¼‰
- `postalCode` ã¯æ•°å­—7æ¡ï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¢ãƒ—ãƒªå±¤ã§å®Ÿæ–½ï¼‰
- é€€ä¼šæ™‚ã¯ `isActive` ã‚’ `false` ã«è¨­å®šï¼ˆè«–ç†å‰Šé™¤ï¼‰
- `email` ã¯usersãƒ†ãƒ¼ãƒ–ãƒ«ã¨é‡è¤‡ã™ã‚‹ãŒã€æ¤œç´¢æ€§èƒ½ã¨ãƒ‡ãƒ¼ã‚¿ã®å†—é•·æ€§ã®ãŸã‚ä¿æŒ

**ç¾åœ¨ã®å®Ÿè£…ã®ç‰¹å¾´**:
- âœ… æœ€å°é™ã®å®Ÿè£…ï¼ˆuserId + role ã®ã¿ï¼‰
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨1:1ã®é–¢ä¿‚
- âœ… ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®æ¨©é™ç®¡ç†
- ğŸ”œ è©³ç´°ãªä¼šå“¡æƒ…å ±ã¯å°†æ¥å®Ÿè£…äºˆå®š

#### member_plans ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰

**ç›®çš„**: ä¼šå“¡ãƒ—ãƒ©ãƒ³ã®ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€ç¾åœ¨æœªå®Ÿè£…ã€‚

##### å®Œå…¨ãªã‚«ãƒ©ãƒ å®šç¾©

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | SERIAL | PK | ãƒ—ãƒ©ãƒ³ID |
| planCode | VARCHAR(50) | UNIQUE, NOT NULL | ãƒ—ãƒ©ãƒ³ã‚³ãƒ¼ãƒ‰ |
| planName | VARCHAR(100) | NOT NULL | ãƒ—ãƒ©ãƒ³åï¼ˆè‹±èªï¼‰ |
| displayName | VARCHAR(100) | NOT NULL | è¡¨ç¤ºåï¼ˆæ—¥æœ¬èªï¼‰ |
| description | TEXT | NULL | ãƒ—ãƒ©ãƒ³èª¬æ˜ |
| price | DECIMAL(10, 2) | NOT NULL | æœˆé¡æ–™é‡‘ |
| hierarchyLevel | INTEGER | NOT NULL | éšå±¤ãƒ¬ãƒ™ãƒ«ï¼ˆ1-3ï¼‰ |
| isBusinessPlan | BOOLEAN | DEFAULT false | æ³•äººãƒ—ãƒ©ãƒ³ãƒ•ãƒ©ã‚° |
| features | JSONB | NULL | ç‰¹å…¸ãƒªã‚¹ãƒˆï¼ˆJSONï¼‰ |
| color | VARCHAR(20) | NULL | UIè¡¨ç¤ºç”¨ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ |
| isActive | BOOLEAN | DEFAULT true | ãƒ—ãƒ©ãƒ³æœ‰åŠ¹çŠ¶æ…‹ |
| createdAt | TIMESTAMP WITH TIME ZONE | DEFAULT NOW() | ä½œæˆæ—¥æ™‚ |
| updatedAt | TIMESTAMP WITH TIME ZONE | DEFAULT NOW() | æ›´æ–°æ—¥æ™‚ |

##### åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆè¨­è¨ˆæ›¸ã‚ˆã‚Šï¼‰

| planCode | displayName | price | hierarchyLevel | isBusinessPlan |
|-----------|--------------|-------|-----------------|------------------|
| individual | å€‹äººä¼šå“¡ | 3000.00 | 1 | false |
| business | æ³•äººä¼šå“¡ | 10000.00 | 2 | true |
| platinum_individual | ãƒ—ãƒ©ãƒãƒŠå€‹äººä¼šå“¡ | 8000.00 | 3 | false |
| platinum_business | ãƒ—ãƒ©ãƒãƒŠæ³•äººä¼šå“¡ | 20000.00 | 3 | true |

**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«**:
- **éšå±¤ãƒ¬ãƒ™ãƒ«**: 1=Individual, 2=Business, 3=Platinum
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: `hierarchyLevel` ãŒå¤§ãã„ã»ã©ä¸‹ä½ãƒ—ãƒ©ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãƒ—ãƒ©ãƒ³ã®å‰Šé™¤ã¯åˆ¶é™ï¼ˆä¼šå“¡ãŒç´ã¥ã„ã¦ã„ã‚‹å ´åˆã¯RESTRICTï¼‰

### ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—

```typescript
export const roleRequests = relations(members, ({ one }) => ({
  owner: one(users, {
    fields: [members.userId],
    references: [users.id],
  }),
}));
```

**å–å¾—ä¾‹**:
```typescript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ä¼šå“¡æƒ…å ±ã‚’çµåˆã—ã¦å–å¾—
const memberWithUser = await db.query.members.findFirst({
  where: eq(members.userId, userId),
  with: {
    owner: true,  // users ãƒ†ãƒ¼ãƒ–ãƒ«ã®æƒ…å ±ã‚’å«ã‚€
  },
});
```

---

## æ¨©é™è¨­è¨ˆ

### ãƒ­ãƒ¼ãƒ«å®šç¾©

| ãƒ­ãƒ¼ãƒ« | èª¬æ˜ | æ¨©é™ |
|--------|------|------|
| **admin** | ç®¡ç†è€… | - ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤<br>- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†<br>- ç®¡ç†ç”»é¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹<br>- å…¬é–‹ãƒ»éå…¬é–‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é–²è¦§ |
| **member** | ä¸€èˆ¬ä¼šå“¡ | - å…¬é–‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é–²è¦§<br>- è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†<br>- ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ |

### æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆç®¡ç†è€…ç”¨ï¼‰

```typescript
// lib/session.ts
export const verifyAdmin = async () => {
  const session = await verifySession();
  const userId = session.user.id;

  const member = await db.query.members.findFirst({
    where: eq(members.userId, userId),
  });

  if (!member || member.role !== "admin") {
    throw new Error("ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™");
  }

  return { userId, memberId: member.id, member };
};
```

#### 2. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆä¼šå“¡ç”¨ï¼‰

```typescript
// lib/session.ts
export const verifyActiveMember = async () => {
  const session = await verifySession();
  const userId = session.user.id;

  const member = await db.query.members.findFirst({
    where: eq(members.userId, userId),
    with: {
      plan: true,  // ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚‚å–å¾—
    },
  });

  if (!member) {
    throw new Error("ä¼šå“¡æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
  }

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
  if (member.status !== "active") {
    throw new Error("ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ä¼šå“¡ç™»éŒ²ã‚’å®Œäº†ã—ã¦ãã ã•ã„");
  }

  return { userId, memberId: member.id, member };
};

export const canAccessContent = (
  member: Member & { plan: MemberPlan },
  content: Content & { requiredPlan: MemberPlan }
): boolean => {
  // ç®¡ç†è€…ã¯å…¨ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  if (member.role === "admin") {
    return true;
  }

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
  if (member.status !== "active") {
    return false;
  }

  // ãƒ—ãƒ©ãƒ³éšå±¤ãƒã‚§ãƒƒã‚¯
  return member.plan.hierarchyLevel >= content.requiredPlan.hierarchyLevel;
};
```

#### 3. ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯

##### ç®¡ç†ç”»é¢

```typescript
// app/[locale]/admin/layout.tsx
export default async function AdminLayout({ children }) {
  const session = await verifySession();
  const adminCheck = await isAdmin();

  if (!adminCheck) {
    redirect("/");
  }

  return <>{children}</>;
}
```

##### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒšãƒ¼ã‚¸

```typescript
// app/[locale]/contents/[id]/page.tsx
export default async function ContentPage({ params }: { params: { id: string } }) {
  const { member } = await verifyActiveMember();
  const content = await getContent(params.id);

  if (!content) {
    notFound();
  }

  // ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãƒã‚§ãƒƒã‚¯
  if (!canAccessContent(member, content)) {
    return <AccessDenied reason="plan" />;
  }

  return <ContentDetail content={content} />;
}
```

#### 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ™ãƒ¼ã‚¹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

```typescript
// middleware.ts ã¾ãŸã¯ layout
export async function checkMemberStatus() {
  const session = await verifySession();
  const member = await getMember(session.user.id);

  if (!member) {
    return { redirect: "/register" };
  }

  switch (member.status) {
    case "pending_payment":
      return { redirect: "/register/payment" };

    case "pending_profile":
      return { redirect: "/profile/complete" };

    case "active":
      return { allowed: true };

    case "inactive":
      return { redirect: "/account-inactive" };

    default:
      return { redirect: "/" };
  }
}
```

#### 5. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§ã®è¡¨ç¤ºåˆ¶å¾¡

```typescript
// components/admin-sidebar.tsx
const session = await auth();
const adminCheck = await isAdmin();

if (!adminCheck) {
  return null;  // ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’éè¡¨ç¤º
}

// components/content-access-banner.tsx
export function ContentAccessBanner({ member }: { member: Member }) {
  if (member.status === "pending_payment") {
    return (
      <Alert variant="warning">
        <AlertTitle>æ”¯æ‰•ã„ãŒå¿…è¦ã§ã™</AlertTitle>
        <AlertDescription>
          ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€æ”¯æ‰•ã„ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚
          <Button asChild>
            <Link href="/register/payment">æ”¯æ‰•ã„ã«é€²ã‚€</Link>
          </Button>
        </AlertDescription>
      </Alert>
    );
  }

  if (member.status === "pending_profile") {
    return (
      <Alert variant="info">
        <AlertTitle>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ãŒå¿…è¦ã§ã™</AlertTitle>
        <AlertDescription>
          ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
          <Button asChild>
            <Link href="/profile/complete">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å…¥åŠ›</Link>
          </Button>
        </AlertDescription>
      </Alert>
    );
  }

  return null;
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è©³ç´°

### ERå›³ï¼ˆå®Œå…¨ç‰ˆè¨­è¨ˆ with Stripe & ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users             â”‚
â”‚  (Better Auth) âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id                  â”‚
â”‚    name                â”‚
â”‚ UK email               â”‚
â”‚    emailVerified       â”‚
â”‚    image               â”‚
â”‚    createdAt           â”‚
â”‚    updatedAt           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ 1
            â”‚
            â”‚ 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     members (å®Œå…¨ç‰ˆè¨­è¨ˆ)                     â”‚
â”‚  âœ… éƒ¨åˆ†å®Ÿè£… ğŸ”œ æ‹¡å¼µäºˆå®š                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK id                            âœ…        â”‚
â”‚ UK,FK userId                     âœ…        â”‚
â”‚ UK email                         ğŸ”œ        â”‚
â”‚ --- æ°åæƒ…å ± ---                           â”‚
â”‚    lastName                      ğŸ”œ        â”‚
â”‚    firstName                     ğŸ”œ        â”‚
â”‚    lastNameKana                  ğŸ”œ        â”‚
â”‚    firstNameKana                 ğŸ”œ        â”‚
â”‚ --- ä½æ‰€æƒ…å ± ---                           â”‚
â”‚    postalCode                    ğŸ”œ        â”‚
â”‚    prefecture                    ğŸ”œ        â”‚
â”‚    city                          ğŸ”œ        â”‚
â”‚    address                       ğŸ”œ        â”‚
â”‚    building                      ğŸ”œ        â”‚
â”‚ --- é€£çµ¡å…ˆ ---                             â”‚
â”‚    phoneNumber                   ğŸ”œ        â”‚
â”‚ --- ãƒ—ãƒ©ãƒ³ãƒ»æ¨©é™ ---                        â”‚
â”‚ FK planId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            ğŸ”œ        â”‚
â”‚    role              â”‚            âœ…        â”‚
â”‚ --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç† ---â”‚                     â”‚
â”‚    status            â”‚            ğŸ”œ        â”‚
â”‚    profileCompleted  â”‚            ğŸ”œ        â”‚
â”‚    paymentCompleted  â”‚            ğŸ”œ        â”‚
â”‚    isActive          â”‚            ğŸ”œ        â”‚
â”‚ --- Stripeé€£æº ---  â”‚                     â”‚
â”‚ UK stripeCustomerId  â”‚            ğŸ”œ        â”‚
â”‚    stripeSubscriptionId          ğŸ”œ        â”‚
â”‚    stripeSubscriptionStatus      ğŸ”œ        â”‚
â”‚    subscriptionStartedAt         ğŸ”œ        â”‚
â”‚    subscriptionEndsAt            ğŸ”œ        â”‚
â”‚    lastPaymentAt                 ğŸ”œ        â”‚
â”‚ --- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ ---                         â”‚
â”‚    createdAt                     âœ…        â”‚
â”‚    updatedAt                     âœ…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ 1       â”‚
            â”‚         â”‚ N
            â”‚ N       â”‚ 1
            â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   â”‚  member_plans ğŸ”œ             â”‚
            â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   â”‚ PK id                        â”‚
            â”‚   â”‚ UK planCode                  â”‚
            â”‚   â”‚    displayName               â”‚
            â”‚   â”‚    price                     â”‚
            â”‚   â”‚    hierarchyLevel            â”‚
            â”‚   â”‚    isBusinessPlan            â”‚
            â”‚   â”‚    features (JSONB)          â”‚
            â”‚   â”‚    stripeProductId  ğŸ”œ       â”‚
            â”‚   â”‚ UK stripePriceId    ğŸ”œ       â”‚
            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   blogs, videos        â”‚
â”‚  schedules, etc âœ…     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ...                 â”‚
â”‚ FK createdBy           â”‚
â”‚    ...                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤–éƒ¨é€£æº:
  Stripe API
  â”œâ”€ Customer (stripeCustomerId)
  â”œâ”€ Subscription (stripeSubscriptionId)
  â”œâ”€ Payment Events
  â””â”€ Webhook â†’ membersãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°

å‡¡ä¾‹:
âœ… å®Ÿè£…æ¸ˆã¿
ğŸ”œ è¨­è¨ˆæ›¸ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒæœªå®Ÿè£…
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ•ãƒ­ãƒ¼

```
1. Better Auth: users ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
   â”œâ”€ id: è‡ªå‹•ç”Ÿæˆ
   â”œâ”€ name: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
   â”œâ”€ email: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
   â””â”€ emailVerified: false

2. Better Auth: accounts ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
   â”œâ”€ userId: users.id
   â”œâ”€ providerId: "credential"
   â””â”€ password: ãƒãƒƒã‚·ãƒ¥åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: members ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
   â”œâ”€ id: nanoid()
   â”œâ”€ userId: users.id
   â””â”€ role: "member"
```

#### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. Better Auth: Email/Passwordæ¤œè¨¼
2. Better Auth: sessions ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: members ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æ¨©é™å–å¾—
4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«æƒ…å ±ã‚’å«ã‚ã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

---

## èªè¨¼ãƒ•ãƒ­ãƒ¼

### ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼

```
æœªç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼
  â”‚
  â”œâ”€â†’ /signup (ã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ãƒšãƒ¼ã‚¸)
  â”‚     - ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®èª¬æ˜
  â”‚     - ä¼šè²»ãƒ»æ¨å¥¨ç’°å¢ƒã®è¡¨ç¤º
  â”‚     - ã€Œç™»éŒ²æ‰‹ç¶šãã«é€²ã‚€ã€ãƒœã‚¿ãƒ³
  â”‚
  â””â”€â†’ /register (æ–°è¦ç™»éŒ²é–‹å§‹)
        â”‚
        â””â”€â†’ /register/auth (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ)
              â”œâ”€ å…¥åŠ›: name, email, password
              â”œâ”€ Better Auth: users + accounts ä½œæˆ
              â”œâ”€ ç‹¬è‡ªå‡¦ç†: members ä½œæˆ (role: member)
              â””â”€ å®Œäº†å¾Œã«è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
              â”‚
              â””â”€â†’ ãƒ—ãƒ©ãƒ³é¸æŠãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ã¸
                  (å°†æ¥å®Ÿè£…äºˆå®š)
```

### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼
  â”‚
  â””â”€â†’ /login
        â”œâ”€ å…¥åŠ›: email, password
        â”œâ”€ Better Auth: èªè¨¼å‡¦ç†
        â”œâ”€ Better Auth: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
        â””â”€ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: /admin or /
```

### ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼

```
èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼
  â”‚
  â””â”€â†’ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
        â”œâ”€ Better Auth: ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
        â””â”€ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: /
```

---

## ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼

### æ–°ã—ã„ç™»éŒ²ãƒ•ãƒ­ãƒ¼è¨­è¨ˆï¼ˆç¢ºå®šç‰ˆï¼‰

#### ãƒ•ãƒ­ãƒ¼å…¨ä½“å›³ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚º - æ±ºæ¸ˆãªã—ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚º - æ±ºæ¸ˆãªã—ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. /signupï¼ˆã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ãƒšãƒ¼ã‚¸ï¼‰âœ… å®Ÿè£…æ¸ˆã¿
   â†“
2. /register/termsï¼ˆä¼šå“¡è¦ç´„åŒæ„ï¼‰ğŸ”œ æœªå®Ÿè£…
   â”œâ”€ ä¼šå“¡è¦ç´„ã®è¡¨ç¤º
   â”œâ”€ åŒæ„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
   â””â”€ ã€ŒåŒæ„ã—ã¦æ¬¡ã¸ã€ãƒœã‚¿ãƒ³
   â†“
3. /register/planï¼ˆä¼šå“¡ç¨®åˆ¥é¸æŠï¼‰ğŸ”œ æœªå®Ÿè£…
   â”œâ”€ Individualï¼ˆå€‹äººä¼šå“¡: 3,000å††/æœˆï¼‰
   â”œâ”€ Businessï¼ˆæ³•äººä¼šå“¡: 10,000å††/æœˆï¼‰
   â”œâ”€ Platinum Individualï¼ˆãƒ—ãƒ©ãƒãƒŠå€‹äºº: 8,000å††/æœˆï¼‰
   â””â”€ Platinum Businessï¼ˆãƒ—ãƒ©ãƒãƒŠæ³•äºº: 20,000å††/æœˆï¼‰
   â†“
4. /register/authï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼‰âœ… å®Ÿè£…æ¸ˆã¿
   â”œâ”€ å…¥åŠ›: name, email, password
   â”œâ”€ Better Auth: users + accounts ä½œæˆ
   â”œâ”€ ç‹¬è‡ªå‡¦ç†: members ä½œæˆ
   â”‚   - role: "member"
   â”‚   - status: "pending_profile"
   â”‚   - planId: é¸æŠã•ã‚ŒãŸãƒ—ãƒ©ãƒ³
   â””â”€ è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
   â†“
5. /dashboard ã¾ãŸã¯ /profileï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ï¼‰âœ… å®Ÿè£…æ¸ˆã¿
   â”œâ”€ status === "pending_profile" ã®å ´åˆ
   â”œâ”€ ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€ãƒãƒŠãƒ¼è¡¨ç¤º
   â””â”€ ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å…¥åŠ›ã™ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ /profile/complete
   â†“
6. /profile/completeï¼ˆè¿½åŠ æƒ…å ±å…¥åŠ›ï¼‰ğŸ”œ æœªå®Ÿè£…
   â”œâ”€ æ°åï¼ˆå§“ãƒ»åã€ã‚»ã‚¤ãƒ»ãƒ¡ã‚¤ï¼‰
   â”œâ”€ ä½æ‰€ï¼ˆéƒµä¾¿ç•ªå·ã€éƒ½é“åºœçœŒã€å¸‚åŒºç”ºæ‘ã€ç•ªåœ°ã€å»ºç‰©åï¼‰
   â”œâ”€ é›»è©±ç•ªå·
   â”œâ”€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†
   â””â”€ ä¿å­˜æ™‚:
      - members ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
      - status â†’ "active"
      - profileCompleted â†’ true
   â†“
7. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ âœ…
   â””â”€ status === "active" ã‹ã¤é©åˆ‡ãªãƒ—ãƒ©ãƒ³
      â†’ ä¼šå“¡é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

#### å°†æ¥ã®æ‹¡å¼µï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚º - Stripeæ±ºæ¸ˆçµ±åˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚º - Stripeæ±ºæ¸ˆçµ±åˆï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. /signupï¼ˆã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ãƒšãƒ¼ã‚¸ï¼‰
   â†“
2. /register/termsï¼ˆä¼šå“¡è¦ç´„åŒæ„ï¼‰
   â†“
3. /register/planï¼ˆä¼šå“¡ç¨®åˆ¥é¸æŠï¼‰
   â†“
4. /register/authï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼‰
   â”œâ”€ members ä½œæˆæ™‚ã« status: "pending_payment" ã‚’è¨­å®š
   â””â”€ è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³
   â†“
5. /register/paymentï¼ˆæ”¯æ‰•ã„å‡¦ç†ï¼‰ğŸ”œ å°†æ¥å®Ÿè£…
   â”œâ”€ Stripe Checkout Sessionä½œæˆ
   â”œâ”€ æ±ºæ¸ˆç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â”œâ”€ æ±ºæ¸ˆå®Œäº†å¾Œã€Webhookã§é€šçŸ¥
   â””â”€ members.status â†’ "pending_profile"
      members.paymentCompleted â†’ true
   â†“
6. /dashboard ã¾ãŸã¯ /profileï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ï¼‰
   â”œâ”€ status === "pending_profile" ã®å ´åˆ
   â””â”€ ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å…¥åŠ›ã™ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ /profile/complete
   â†“
7. /profile/completeï¼ˆè¿½åŠ æƒ…å ±å…¥åŠ›ï¼‰
   â”œâ”€ status â†’ "active"
   â””â”€ profileCompleted â†’ true
   â†“
8. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ…‹ï¼ˆç°¡æ˜“ç‰ˆï¼‰

```
/signup (æƒ…å ±æä¾›ãƒšãƒ¼ã‚¸) âœ…
  â”‚
  â””â”€â†’ /register (ç™»éŒ²é–‹å§‹) âœ…
        â”‚
        â””â”€â†’ /register/auth (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ) âœ…
              â”œâ”€ Better Auth: users ä½œæˆ
              â”œâ”€ Better Auth: accounts ä½œæˆ (passwordä¿å­˜)
              â”œâ”€ ç‹¬è‡ªå‡¦ç†: members ä½œæˆ (role: member)
              â””â”€ è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ â†’ å®Œäº†
```

### å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°

#### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ï¼ˆ/signupï¼‰âœ… å®Ÿè£…æ¸ˆã¿

**å®Ÿè£…å†…å®¹**:
- ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®èª¬æ˜
- ä¼šè²»ãƒ»æ¨å¥¨ç’°å¢ƒã®è¡¨ç¤º
- ã€Œç™»éŒ²æ‰‹ç¶šãã«é€²ã‚€ã€ãƒœã‚¿ãƒ³

#### ã‚¹ãƒ†ãƒƒãƒ—2: ä¼šå“¡è¦ç´„åŒæ„ï¼ˆ/register/termsï¼‰ğŸ”œ æœªå®Ÿè£…

**å®Ÿè£…å†…å®¹**:
- ä¼šå“¡è¦ç´„ã®è¡¨ç¤ºï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰
- åŒæ„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
- ã€ŒåŒæ„ã—ã¦æ¬¡ã¸ã€ãƒœã‚¿ãƒ³ï¼ˆãƒã‚§ãƒƒã‚¯å¿…é ˆï¼‰

**çŠ¶æ…‹ç®¡ç†**:
```typescript
// RegistrationContext ã«è¿½åŠ 
{
  termsAgreed: boolean;
  termsAgreedAt: Date | null;
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ä¼šå“¡ç¨®åˆ¥é¸æŠï¼ˆ/register/planï¼‰ğŸ”œ æœªå®Ÿè£…

**å®Ÿè£…å†…å®¹**:
- 4ã¤ã®ãƒ—ãƒ©ãƒ³ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤º
- å„ãƒ—ãƒ©ãƒ³ã®ç‰¹å¾´ãƒ»æ–™é‡‘è¡¨ç¤º
- ãƒ—ãƒ©ãƒ³é¸æŠãƒœã‚¿ãƒ³

**çŠ¶æ…‹ç®¡ç†**:
```typescript
// RegistrationContext ã«è¿½åŠ 
{
  selectedPlanId: number | null;
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆ/register/authï¼‰âœ… å®Ÿè£…æ¸ˆã¿

**ç¾åœ¨ã®å®Ÿè£…**:
- name, email, password ã®å…¥åŠ›
- Better Auth ã«ã‚ˆã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
- members ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆrole: "member" ã®ã¿ï¼‰

**å¿…è¦ãªä¿®æ­£ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼‰**:
```typescript
// members ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚ã«è¿½åŠ 
{
  role: "member",
  planId: registrationData.selectedPlanId,  // â† è¿½åŠ 
  status: "pending_profile",                 // â† è¿½åŠ ï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
  profileCompleted: false,                   // â† è¿½åŠ 
}
```

**ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆStripeçµ±åˆå¾Œï¼‰ã®è¿½åŠ é …ç›®**:
```typescript
{
  // ä¸Šè¨˜ã«åŠ ãˆã¦
  paymentCompleted: false,                   // â† è¿½åŠ 
  // status: "pending_payment" ã«å¤‰æ›´
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—5: ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã®ä¿ƒé€²ï¼ˆ/dashboardï¼‰âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆè¦ä¿®æ­£ï¼‰

**å¿…è¦ãªå®Ÿè£…ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼‰**:
```typescript
// status ãƒã‚§ãƒƒã‚¯
if (member.status === "pending_profile") {
  return <ProfileCompletionBanner />; // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ä¿ƒé€²
}
```

**ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆStripeçµ±åˆå¾Œï¼‰ã®è¿½åŠ **:
```typescript
if (member.status === "pending_payment") {
  return <PaymentRequiredBanner />; // æ”¯æ‰•ã„ä¿ƒé€²
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—6: è¿½åŠ æƒ…å ±å…¥åŠ›ï¼ˆ/profile/completeï¼‰ğŸ”œ æœªå®Ÿè£…

**å®Ÿè£…å†…å®¹**:
- æ°åã€ä½æ‰€ã€é›»è©±ç•ªå·ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆZodï¼‰
- ä¿å­˜æ™‚ã« members ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
- status ã‚’ "active" ã«å¤‰æ›´

#### ã‚¹ãƒ†ãƒƒãƒ—7: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹

**ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
function canAccessContent(member: Member, content: Content): boolean {
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
  if (member.status !== "active") {
    return false;
  }

  // ãƒ—ãƒ©ãƒ³éšå±¤ãƒã‚§ãƒƒã‚¯
  const userPlan = getMemberPlan(member.planId);
  const contentPlan = getMemberPlan(content.requiredPlanId);

  return userPlan.hierarchyLevel >= contentPlan.hierarchyLevel;
}
```

---

## Stripeæ±ºæ¸ˆçµ±åˆè¨­è¨ˆï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚º - å°†æ¥å¯¾å¿œï¼‰

**æ³¨æ„**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å°†æ¥å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯æ±ºæ¸ˆæ©Ÿèƒ½ã¯å®Ÿè£…ã›ãšã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›å®Œäº†å¾Œã«å³åº§ã« `status: "active"` ã¨ãªã‚Šã¾ã™ã€‚

### æ¦‚è¦

ä¼šå“¡ç™»éŒ²æ™‚ã®æ”¯æ‰•ã„å‡¦ç†ã«Stripeã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæœˆé¡èª²é‡‘ï¼‰ãƒ¢ãƒ‡ãƒ«ã‚’æ¡ç”¨ã€‚

### ä½¿ç”¨ã™ã‚‹Stripeæ©Ÿèƒ½

| æ©Ÿèƒ½ | ç”¨é€” |
|------|------|
| **Checkout Session** | æ±ºæ¸ˆç”»é¢ã¸ã®èª˜å° |
| **Customer** | é¡§å®¢æƒ…å ±ã®ç®¡ç† |
| **Subscription** | æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç† |
| **Product & Price** | ãƒ—ãƒ©ãƒ³ãƒ»æ–™é‡‘ã®ç®¡ç† |
| **Webhook** | æ±ºæ¸ˆã‚¤ãƒ™ãƒ³ãƒˆã®å—ä¿¡ |

### Stripeãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆmembers ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ï¼‰ğŸ”œ å°†æ¥å¯¾å¿œ

ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã§ membersãƒ†ãƒ¼ãƒ–ãƒ«ã«Stripeé–¢é€£ã‚«ãƒ©ãƒ ã‚’è¿½åŠ äºˆå®š:

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---------|-----|------|------|---------|
| paymentCompleted | BOOLEAN | NULL | æ”¯æ‰•ã„å®Œäº†ãƒ•ãƒ©ã‚° | ğŸ”œ å°†æ¥è¿½åŠ  |
| stripeCustomerId | VARCHAR(255) | NULL, UNIQUE | Stripe Customer ID | ğŸ”œ å°†æ¥è¿½åŠ  |
| stripeSubscriptionId | VARCHAR(255) | NULL | Stripe Subscription ID | ğŸ”œ å°†æ¥è¿½åŠ  |
| stripeSubscriptionStatus | VARCHAR(50) | NULL | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸ”œ å°†æ¥è¿½åŠ  |
| subscriptionStartedAt | TIMESTAMP | NULL | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–‹å§‹æ—¥æ™‚ | ğŸ”œ å°†æ¥è¿½åŠ  |
| subscriptionEndsAt | TIMESTAMP | NULL | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çµ‚äº†æ—¥æ™‚ | ğŸ”œ å°†æ¥è¿½åŠ  |
| lastPaymentAt | TIMESTAMP | NULL | æœ€å¾Œã®æ”¯æ‰•ã„æ—¥æ™‚ | ğŸ”œ å°†æ¥è¿½åŠ  |

### Stripeã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| Stripeã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | membersãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®åæ˜  |
|----------------|---------------------|
| `active` | status: "pending_profile" (åˆå›ã®ã¿) ã¾ãŸã¯ "active" |
| `past_due` | æ”¯æ‰•ã„é…å»¶ã®è­¦å‘Šè¡¨ç¤ºã€ã‚¢ã‚¯ã‚»ã‚¹ç¶­æŒ |
| `canceled` | status: "inactive", ã‚¢ã‚¯ã‚»ã‚¹åœæ­¢ |
| `unpaid` | status: "inactive", ã‚¢ã‚¯ã‚»ã‚¹åœæ­¢ |
| `incomplete` | status: "pending_payment", ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ |

### æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼è©³ç´°

#### 1. Checkout Session ä½œæˆ

```typescript
// app/api/stripe/create-checkout-session/route.ts
import Stripe from 'stripe';

export async function POST(request: Request) {
  const { planId, memberId } = await request.json();

  // ãƒ—ãƒ©ãƒ³æƒ…å ±å–å¾—
  const plan = await getMemberPlan(planId);

  // Stripe Checkout Session ä½œæˆ
  const session = await stripe.checkout.sessions.create({
    mode: 'subscription',
    customer_email: member.email,
    client_reference_id: memberId,
    line_items: [
      {
        price: plan.stripePriceId, // Stripe Price ID
        quantity: 1,
      },
    ],
    success_url: `${process.env.NEXT_PUBLIC_URL}/register/payment/success?session_id={CHECKOUT_SESSION_ID}`,
    cancel_url: `${process.env.NEXT_PUBLIC_URL}/register/payment/cancel`,
    metadata: {
      memberId: memberId,
      planId: planId.toString(),
    },
  });

  return Response.json({ sessionId: session.id });
}
```

#### 2. Webhookå‡¦ç†

```typescript
// app/api/stripe/webhook/route.ts
import { headers } from 'next/headers';
import Stripe from 'stripe';

export async function POST(request: Request) {
  const body = await request.text();
  const signature = headers().get('stripe-signature');

  let event: Stripe.Event;

  try {
    event = stripe.webhooks.constructEvent(
      body,
      signature!,
      process.env.STRIPE_WEBHOOK_SECRET!
    );
  } catch (err) {
    return Response.json({ error: 'Invalid signature' }, { status: 400 });
  }

  switch (event.type) {
    case 'checkout.session.completed':
      await handleCheckoutCompleted(event.data.object);
      break;

    case 'customer.subscription.updated':
      await handleSubscriptionUpdated(event.data.object);
      break;

    case 'customer.subscription.deleted':
      await handleSubscriptionDeleted(event.data.object);
      break;

    case 'invoice.payment_succeeded':
      await handlePaymentSucceeded(event.data.object);
      break;

    case 'invoice.payment_failed':
      await handlePaymentFailed(event.data.object);
      break;
  }

  return Response.json({ received: true });
}

async function handleCheckoutCompleted(session: Stripe.Checkout.Session) {
  const memberId = session.metadata?.memberId;
  const subscription = await stripe.subscriptions.retrieve(
    session.subscription as string
  );

  // members ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
  await db.update(members)
    .set({
      status: 'pending_profile',
      paymentCompleted: true,
      stripeCustomerId: session.customer as string,
      stripeSubscriptionId: session.subscription as string,
      stripeSubscriptionStatus: subscription.status,
      subscriptionStartedAt: new Date(subscription.current_period_start * 1000),
      subscriptionEndsAt: new Date(subscription.current_period_end * 1000),
      lastPaymentAt: new Date(),
    })
    .where(eq(members.id, memberId!));
}

async function handleSubscriptionUpdated(subscription: Stripe.Subscription) {
  // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
  await db.update(members)
    .set({
      stripeSubscriptionStatus: subscription.status,
      subscriptionEndsAt: new Date(subscription.current_period_end * 1000),
    })
    .where(eq(members.stripeSubscriptionId, subscription.id));
}

async function handleSubscriptionDeleted(subscription: Stripe.Subscription) {
  // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‰Šé™¤ï¼ˆé€€ä¼šï¼‰
  await db.update(members)
    .set({
      status: 'inactive',
      stripeSubscriptionStatus: 'canceled',
      isActive: false,
    })
    .where(eq(members.stripeSubscriptionId, subscription.id));
}

async function handlePaymentSucceeded(invoice: Stripe.Invoice) {
  // ç¶™ç¶šèª²é‡‘æˆåŠŸ
  await db.update(members)
    .set({
      lastPaymentAt: new Date(),
    })
    .where(eq(members.stripeCustomerId, invoice.customer as string));
}

async function handlePaymentFailed(invoice: Stripe.Invoice) {
  // æ”¯æ‰•ã„å¤±æ•—ã®é€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã©ï¼‰
  // çŒ¶äºˆæœŸé–“å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹åœæ­¢ã®å‡¦ç†
}
```

### member_plansãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®Stripeæƒ…å ±è¿½åŠ ğŸ”œ å°†æ¥å¯¾å¿œ

ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã§ member_plansãƒ†ãƒ¼ãƒ–ãƒ«ã«Stripeé–¢é€£ã‚«ãƒ©ãƒ ã‚’è¿½åŠ äºˆå®š:

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---------|-----|------|------|---------|
| stripeProductId | VARCHAR(255) | NULL | Stripe Product ID | ğŸ”œ å°†æ¥è¿½åŠ  |
| stripePriceId | VARCHAR(255) | NULL, UNIQUE | Stripe Price ID | ğŸ”œ å°†æ¥è¿½åŠ  |

### StripeåˆæœŸè¨­å®šğŸ”œ å°†æ¥å¯¾å¿œ

**æ³¨æ„**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã—ã¾ã™ã€‚

#### 1. Productã®ä½œæˆ

```bash
# Individual Plan
stripe products create \
  --name="Individual Membership" \
  --description="å€‹äººä¼šå“¡ãƒ—ãƒ©ãƒ³"

# Priceä½œæˆ
stripe prices create \
  --product=prod_xxx \
  --unit-amount=300000 \
  --currency=jpy \
  --recurring[interval]=month
```

#### 2. Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­å®š

```bash
stripe listen --forward-to localhost:3000/api/stripe/webhook
```

**æœ¬ç•ªç’°å¢ƒ**:
- Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
- URL: `https://your-domain.com/api/stripe/webhook`
- ã‚¤ãƒ™ãƒ³ãƒˆé¸æŠ:
  - `checkout.session.completed`
  - `customer.subscription.updated`
  - `customer.subscription.deleted`
  - `invoice.payment_succeeded`
  - `invoice.payment_failed`

### ç’°å¢ƒå¤‰æ•°ğŸ”œ å°†æ¥å¯¾å¿œ

```env
# .env.localï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã§è¿½åŠ ï¼‰
STRIPE_PUBLIC_KEY=pk_test_xxx
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# æœ¬ç•ªç’°å¢ƒ
STRIPE_PUBLIC_KEY=pk_live_xxx
STRIPE_SECRET_KEY=sk_live_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰

é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ç•ªå·ï¼ˆç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã§ä½¿ç”¨ï¼‰:
- æˆåŠŸ: `4242 4242 4242 4242`
- 3Dã‚»ã‚­ãƒ¥ã‚¢èªè¨¼: `4000 0025 0000 3155`
- å¤±æ•—: `4000 0000 0000 0002`

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹:
1. **Webhookç½²åæ¤œè¨¼**: å¿…é ˆï¼ˆä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ãï¼‰
2. **å†ªç­‰æ€§**: åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆãŒè¤‡æ•°å›é€ä¿¡ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚’è€ƒæ…®
3. **APIã‚­ãƒ¼ã®ç®¡ç†**: ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã€ã‚³ãƒŸãƒƒãƒˆã—ãªã„
4. **é‡‘é¡ã®æ¤œè¨¼**: Webhookã§å—ã‘å–ã£ãŸé‡‘é¡ãŒæœŸå¾…å€¤ã¨ä¸€è‡´ã™ã‚‹ã‹ç¢ºèª

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†

**ãƒãƒƒã‚·ãƒ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **: Better Auth ãŒè‡ªå‹•çš„ã«å®‰å…¨ãªãƒãƒƒã‚·ãƒ¥åŒ–ã‚’å®Ÿæ–½
- bcrypt ã¾ãŸã¯ argon2 ã‚’ä½¿ç”¨ï¼ˆBetter Authã®è¨­å®šã«ã‚ˆã‚‹ï¼‰
- ã‚½ãƒ«ãƒˆä»˜ããƒãƒƒã‚·ãƒ¥
- ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒã¸ã®è€æ€§

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**æ–¹å¼**: ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³
- HTTPOnly Cookie
- Secure ãƒ•ãƒ©ã‚°ï¼ˆHTTPSç’°å¢ƒï¼‰
- SameSite å±æ€§ã«ã‚ˆã‚‹CSRFå¯¾ç­–
- è‡ªå‹•æœŸé™åˆ‡ã‚Œ

### CSRFå¯¾ç­–

**å®Ÿè£…**: Better Auth ã«ã‚ˆã‚‹è‡ªå‹•ä¿è­·
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
- Origin ãƒ˜ãƒƒãƒ€ãƒ¼ãƒã‚§ãƒƒã‚¯

### XSSå¯¾ç­–

**å®Ÿè£…**: React ã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- ã™ã¹ã¦ã®å‡ºåŠ›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- dangerouslySetInnerHTML ã®ä½¿ç”¨åˆ¶é™

### SQL Injectionå¯¾ç­–

**å®Ÿè£…**: Drizzle ORM ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
- ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆä½¿ç”¨
- å‹•çš„SQLç”Ÿæˆã®å›é¿

### æ¨©é™ãƒã‚§ãƒƒã‚¯

**å¤šå±¤é˜²å¾¡**:
1. ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«: layout.tsx ã§ã®èªè¨¼ç¢ºèª
2. ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«: å€‹åˆ¥é–¢æ•°ã§ã®æ¨©é™ç¢ºèª
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«: å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„

**å®Ÿè£…ä¾‹**:
```typescript
// ã™ã¹ã¦ã®ç®¡ç†è€…å°‚ç”¨ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿæ–½
export async function createBlog(data: BlogFormData) {
  const { userId, memberId } = await verifyAdmin();  // â† å¿…é ˆ
  // ... å‡¦ç†
}
```

---

## å®Ÿè£…çŠ¶æ³

### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

#### èªè¨¼æ©Ÿèƒ½
- âœ… Email/Password ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
- âœ… Email/Password ãƒ­ã‚°ã‚¤ãƒ³
- âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- âœ… è‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿æŒï¼‰

#### ä¼šå“¡ç®¡ç†æ©Ÿèƒ½
- âœ… ä¼šå“¡ãƒ¬ã‚³ãƒ¼ãƒ‰è‡ªå‹•ä½œæˆï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æ™‚ï¼‰
- âœ… ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹æ¨©é™ç®¡ç†ï¼ˆadmin / memberï¼‰
- âœ… ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆ`verifyAdmin()`ï¼‰
- âœ… æ¨©é™ã«ã‚ˆã‚‹ç”»é¢åˆ¶å¾¡ï¼ˆç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ï¼‰

#### UI
- âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆ`/login`ï¼‰
- âœ… ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æƒ…å ±ãƒšãƒ¼ã‚¸ï¼ˆ`/signup`ï¼‰
- âœ… ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒšãƒ¼ã‚¸ï¼ˆ`/register/auth`ï¼‰
- âœ… ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆèªè¨¼ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰

### æœªå®Ÿè£…æ©Ÿèƒ½ï¼ˆè¨­è¨ˆæ›¸ã«è¨˜è¼‰ï¼‰

#### ç¬¬1ãƒ•ã‚§ãƒ¼ã‚º - å„ªå…ˆå®Ÿè£…ï¼ˆæ±ºæ¸ˆãªã—ï¼‰

**ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
- ğŸ”œ ä¼šå“¡è¦ç´„åŒæ„ãƒšãƒ¼ã‚¸ï¼ˆ`/register/terms`ï¼‰
- ğŸ”œ ãƒ—ãƒ©ãƒ³é¸æŠæ©Ÿèƒ½ï¼ˆ`/register/plan`ï¼‰
- ğŸ”œ è©³ç´°ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›ï¼ˆ`/profile/complete`ï¼‰

**ãƒ—ãƒ©ãƒ³ç®¡ç†**:
- ğŸ”œ member_plans ãƒ†ãƒ¼ãƒ–ãƒ«
- ğŸ”œ ãƒ—ãƒ©ãƒ³ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆIndividual / Business / Platinumï¼‰
- ğŸ”œ ãƒ—ãƒ©ãƒ³åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ğŸ”œ éšå±¤çš„ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†

**è¿½åŠ ä¼šå“¡æƒ…å ±**:
- ğŸ”œ æ°åï¼ˆå§“ãƒ»åã€ã‚»ã‚¤ãƒ»ãƒ¡ã‚¤ï¼‰
- ğŸ”œ ä½æ‰€ï¼ˆéƒµä¾¿ç•ªå·ã€éƒ½é“åºœçœŒã€å¸‚åŒºç”ºæ‘ã€ç•ªåœ°ã€å»ºç‰©åï¼‰
- ğŸ”œ é›»è©±ç•ªå·

**ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**:
- ğŸ”œ status ã‚«ãƒ©ãƒ ï¼ˆpending_profile / active / inactiveï¼‰
- ğŸ”œ profileCompleted ã‚«ãƒ©ãƒ 
- ğŸ”œ isActive ã‚«ãƒ©ãƒ 

#### ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º - å°†æ¥å®Ÿè£…ï¼ˆStripeæ±ºæ¸ˆçµ±åˆï¼‰

**æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼**:
- ğŸ”œ æ”¯æ‰•ã„å‡¦ç†ãƒšãƒ¼ã‚¸ï¼ˆ`/register/payment`ï¼‰
- ğŸ”œ æ”¯æ‰•ã„æˆåŠŸãƒšãƒ¼ã‚¸ï¼ˆ`/register/payment/success`ï¼‰
- ğŸ”œ æ”¯æ‰•ã„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒšãƒ¼ã‚¸ï¼ˆ`/register/payment/cancel`ï¼‰

**Stripeçµ±åˆ**:
- ğŸ”œ Stripe Checkout Sessionä½œæˆAPI
- ğŸ”œ Stripe Webhookå‡¦ç†
- ğŸ”œ Stripe Customer Portal
- ğŸ”œ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†

**æ±ºæ¸ˆé–¢é€£ã‚«ãƒ©ãƒ **:
- ğŸ”œ paymentCompleted ã‚«ãƒ©ãƒ 
- ğŸ”œ stripeCustomerId ã‚«ãƒ©ãƒ 
- ğŸ”œ stripeSubscriptionId ã‚«ãƒ©ãƒ 
- ğŸ”œ stripeSubscriptionStatus ã‚«ãƒ©ãƒ 
- ğŸ”œ subscriptionStartedAt / subscriptionEndsAt ã‚«ãƒ©ãƒ 

**member_plansãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è¿½åŠ **:
- ğŸ”œ stripeProductId ã‚«ãƒ©ãƒ 
- ğŸ”œ stripePriceId ã‚«ãƒ©ãƒ 

#### ãã®ä»–ã®æ‹¡å¼µï¼ˆå„ªå…ˆåº¦ä½ï¼‰

**èªè¨¼æ©Ÿèƒ½æ‹¡å¼µ**:
- ğŸ”œ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèª
- ğŸ”œ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- ğŸ”œ OAuthé€£æºï¼ˆGoogle, GitHubç­‰ï¼‰

**ä¼šå“¡æƒ…å ±ç®¡ç†**:
- ğŸ”œ ä¼šç¤¾åï¼ˆæ³•äººä¼šå“¡ã®å ´åˆï¼‰
- ğŸ”œ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒšãƒ¼ã‚¸ã®æ‹¡å……
- ğŸ”œ ãƒ—ãƒ©ãƒ³å¤‰æ›´æ©Ÿèƒ½

---

## å‹å®šç¾©

### å®Ÿè£…æ¸ˆã¿å‹å®šç¾©

#### Userå‹ï¼ˆèªè¨¼å±¤ï¼‰

```typescript
// types/user.ts
import { authClient } from "@/lib/auth-client";

export type User = typeof authClient.$Infer.Session["user"];
```

**å†…å®¹**:
```typescript
type User = {
  id: string;
  name: string;
  email: string;
  emailVerified: boolean;
  image: string | null;
  createdAt: Date;
  updatedAt: Date;
}
```

#### SignupFormDataå‹

```typescript
// types/signup.ts
import { signupFormSchema } from "@/zod/signup";
import { z } from "zod";

export type SignupFormData = z.infer<typeof signupFormSchema>;
```

**å†…å®¹**:
```typescript
type SignupFormData = {
  name: string;
  email: string;
  password: string;
}
```

#### Memberå‹ï¼ˆä¼šå“¡ç®¡ç†å±¤ï¼‰

##### ç¾åœ¨å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å‹ï¼ˆç°¡æ˜“ç‰ˆï¼‰

```typescript
// Drizzle ORMã‹ã‚‰ã®å‹æ¨è«–
import { members } from "@/db/schemas/member";

export type Member = typeof members.$inferSelect;
```

**å†…å®¹**:
```typescript
type Member = {
  id: string;
  userId: string;
  role: "admin" | "member";
  createdAt: Date;
  updatedAt: Date;
}
```

##### å°†æ¥å®Ÿè£…äºˆå®šã®å®Œå…¨ãªå‹

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸ã«åŸºã¥ãå®Œå…¨ç‰ˆã®membersãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®Ÿè£…ã•ã‚ŒãŸå ´åˆã®å‹:

```typescript
type MemberComplete = {
  // åŸºæœ¬æƒ…å ±
  id: string;
  userId: string;
  email: string;

  // æ°åæƒ…å ±
  lastName: string;
  firstName: string;
  lastNameKana: string;
  firstNameKana: string;

  // ä½æ‰€æƒ…å ±
  postalCode: string;
  prefecture: string;
  city: string;
  address: string;
  building: string | null;

  // é€£çµ¡å…ˆæƒ…å ±
  phoneNumber: string;

  // ãƒ—ãƒ©ãƒ³ãƒ»æ¨©é™æƒ…å ±
  planId: number;
  role: "admin" | "member";
  isActive: boolean;

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  createdAt: Date;
  updatedAt: Date;
}
```

#### MemberPlanå‹ï¼ˆæœªå®Ÿè£…ï¼‰

å°†æ¥å®Ÿè£…äºˆå®šã®ä¼šå“¡ãƒ—ãƒ©ãƒ³å‹:

```typescript
type MemberPlan = {
  id: number;
  planCode: string;
  planName: string;
  displayName: string;
  description: string | null;
  price: number; // DECIMAL(10, 2)
  hierarchyLevel: number; // 1-3
  isBusinessPlan: boolean;
  features: object | null; // JSONB
  color: string | null;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ

### å®Ÿè£…æ¸ˆã¿: ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ 

```typescript
// zod/signup.ts
export const signupFormSchema = z.object({
  name: z.string()
    .trim()
    .min(1, "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(50, "åå‰ã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  email: z.string()
    .trim()
    .min(1, "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .email("æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"),
  password: z.string()
    .min(8, "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .regex(
      /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,
      "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¤§æ–‡å­—ã€å°æ–‡å­—ã€æ•°å­—ã‚’å«ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™"
    ),
});
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«**:
- åå‰: 1ã€œ50æ–‡å­—ã€å‰å¾Œã®ç©ºç™½é™¤å»
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: æ¨™æº–çš„ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: 8ã€œ100æ–‡å­—ã€å¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»æ•°å­—ã‚’å„1æ–‡å­—ä»¥ä¸Šå«ã‚€

### å°†æ¥å®Ÿè£…äºˆå®š: ä¼šå“¡ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¼ãƒ 

å®Œå…¨ãªä¼šå“¡æƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒæ¡ˆ:

```typescript
// zod/member-profile.tsï¼ˆæœªå®Ÿè£…ï¼‰
export const memberProfileFormSchema = z.object({
  // æ°åæƒ…å ±
  lastName: z.string()
    .trim()
    .min(1, "å§“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "å§“ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  firstName: z.string()
    .trim()
    .min(1, "åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "åã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  lastNameKana: z.string()
    .trim()
    .min(1, "ã‚»ã‚¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "ã‚»ã‚¤ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .regex(/^[ã‚¡-ãƒ¶ãƒ¼]+$/, "ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  firstNameKana: z.string()
    .trim()
    .min(1, "ãƒ¡ã‚¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "ãƒ¡ã‚¤ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .regex(/^[ã‚¡-ãƒ¶ãƒ¼]+$/, "ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›ã—ã¦ãã ã•ã„"),

  // ä½æ‰€æƒ…å ±
  postalCode: z.string()
    .trim()
    .regex(/^\d{7}$/, "éƒµä¾¿ç•ªå·ã¯7æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  prefecture: z.string()
    .trim()
    .min(1, "éƒ½é“åºœçœŒã‚’é¸æŠã—ã¦ãã ã•ã„")
    .max(50, "éƒ½é“åºœçœŒã¯50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  city: z.string()
    .trim()
    .min(1, "å¸‚åŒºç”ºæ‘ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(100, "å¸‚åŒºç”ºæ‘ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  address: z.string()
    .trim()
    .min(1, "ç”ºåç•ªåœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(255, "ç”ºåç•ªåœ°ã¯255æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  building: z.string()
    .trim()
    .max(255, "å»ºç‰©åã¯255æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .optional(),

  // é€£çµ¡å…ˆæƒ…å ±
  phoneNumber: z.string()
    .trim()
    .regex(/^0\d{9,10}$/, "æœ‰åŠ¹ãªé›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰"),
});
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«**:
- æ°å: å„100æ–‡å­—ä»¥å†…ã€ã‚«ãƒŠã¯ã‚«ã‚¿ã‚«ãƒŠã®ã¿
- éƒµä¾¿ç•ªå·: 7æ¡ã®æ•°å­—ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰
- éƒ½é“åºœçœŒ: 50æ–‡å­—ä»¥å†…
- å¸‚åŒºç”ºæ‘: 100æ–‡å­—ä»¥å†…
- ç”ºåç•ªåœ°: 255æ–‡å­—ä»¥å†…ã€å¿…é ˆ
- å»ºç‰©å: 255æ–‡å­—ä»¥å†…ã€ä»»æ„
- é›»è©±ç•ªå·: 0ã‹ã‚‰å§‹ã¾ã‚‹10ã€œ11æ¡ã®æ•°å­—ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰

---

## URLè¨­è¨ˆ

### èªè¨¼ãƒ»ç™»éŒ²é–¢é€£URL

#### ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆæ±ºæ¸ˆãªã—ï¼‰

| URL | èª¬æ˜ | ã‚¢ã‚¯ã‚»ã‚¹æ¨© | å®Ÿè£…çŠ¶æ³ |
|-----|------|-----------|---------|
| `/login` | ãƒ­ã‚°ã‚¤ãƒ³ | æœªèªè¨¼ã®ã¿ | âœ… |
| `/signup` | ã‚µãƒ¼ãƒ“ã‚¹èª¬æ˜ãƒ»ä¼šå“¡ç™»éŒ²æ¡ˆå†… | æœªèªè¨¼ã®ã¿ | âœ… |
| `/register` | ç™»éŒ²ãƒ•ãƒ­ãƒ¼é–‹å§‹ | æœªèªè¨¼ã®ã¿ | âœ… |
| `/register/terms` | ä¼šå“¡è¦ç´„åŒæ„ | æœªèªè¨¼ã®ã¿ | ğŸ”œ ç¬¬1ãƒ•ã‚§ãƒ¼ã‚º |
| `/register/plan` | ãƒ—ãƒ©ãƒ³é¸æŠ | æœªèªè¨¼ã®ã¿ | ğŸ”œ ç¬¬1ãƒ•ã‚§ãƒ¼ã‚º |
| `/register/auth` | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ | æœªèªè¨¼ã®ã¿ | âœ… |

#### ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆStripeæ±ºæ¸ˆçµ±åˆï¼‰

| URL | èª¬æ˜ | ã‚¢ã‚¯ã‚»ã‚¹æ¨© | å®Ÿè£…çŠ¶æ³ |
|-----|------|-----------|---------|
| `/register/payment` | æ”¯æ‰•ã„å‡¦ç†ï¼ˆStripeï¼‰ | èªè¨¼æ¸ˆã¿ãƒ»status: pending_payment | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |
| `/register/payment/success` | æ”¯æ‰•ã„æˆåŠŸ | èªè¨¼æ¸ˆã¿ | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |
| `/register/payment/cancel` | æ”¯æ‰•ã„ã‚­ãƒ£ãƒ³ã‚»ãƒ« | èªè¨¼æ¸ˆã¿ | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |

### ä¼šå“¡å°‚ç”¨URL

| URL | èª¬æ˜ | ã‚¢ã‚¯ã‚»ã‚¹æ¨© | å®Ÿè£…çŠ¶æ³ |
|-----|------|-----------|---------|
| `/dashboard` | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | èªè¨¼æ¸ˆã¿ | âœ… |
| `/profile` | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | èªè¨¼æ¸ˆã¿ | âœ… |
| `/profile/complete` | è¿½åŠ æƒ…å ±å…¥åŠ› | èªè¨¼æ¸ˆã¿ãƒ»status: pending_profile | ğŸ”œ ç¬¬1ãƒ•ã‚§ãƒ¼ã‚º |
| `/contents` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | status: active ã®ã¿ | âœ…ï¼ˆè¦ä¿®æ­£ï¼‰ |
| `/contents/[id]` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è©³ç´° | status: active + ãƒ—ãƒ©ãƒ³ç¢ºèª | âœ…ï¼ˆè¦ä¿®æ­£ï¼‰ |
| `/admin/*` | ç®¡ç†ç”»é¢ | ç®¡ç†è€…ã®ã¿ | âœ… |

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆStripeæ±ºæ¸ˆçµ±åˆï¼‰

| URL | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | å®Ÿè£…çŠ¶æ³ |
|-----|---------|------|---------|
| `/api/stripe/create-checkout-session` | POST | Stripe Checkout Session ä½œæˆ | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |
| `/api/stripe/webhook` | POST | Stripe Webhookå—ä¿¡ | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |
| `/api/stripe/customer-portal` | POST | Stripe Customer Portalä½œæˆ | ğŸ”œ ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º |

---

## ã¾ã¨ã‚

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­è¨ˆã®ç‰¹å¾´

1. **2å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**
   - èªè¨¼å±¤: Better Authï¼ˆå°‚é–€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
   - ä¼šå“¡ç®¡ç†å±¤: ç‹¬è‡ªå®Ÿè£…ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰

2. **æ®µéšçš„ãªæƒ…å ±åé›†**
   - æœ€å°é™ã®æƒ…å ±ã§èªè¨¼å®Œäº†
   - è©³ç´°æƒ…å ±ã¯ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã§åé›†ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ï¼‰

3. **æŸ”è»Ÿãªæ¨©é™ç®¡ç†**
   - ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹: admin / member
   - ãƒ—ãƒ©ãƒ³ãƒ™ãƒ¼ã‚¹: Individual / Business / Platinumï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ï¼‰

4. **æ®µéšçš„ãªæ©Ÿèƒ½è¿½åŠ **
   - ç¬¬1ãƒ•ã‚§ãƒ¼ã‚º: æ±ºæ¸ˆãªã—ã§ä¼šå“¡ç™»éŒ²ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
   - ç¬¬2ãƒ•ã‚§ãƒ¼ã‚º: Stripeæ±ºæ¸ˆçµ±åˆã«ã‚ˆã‚‹ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†

5. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‡è¦–**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - CSRF/XSSå¯¾ç­–
   - å¤šå±¤é˜²å¾¡

### å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

#### ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå„ªå…ˆå®Ÿè£… - æ±ºæ¸ˆãªã—ï¼‰

##### 1. member_plansãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

**å®Ÿè£…å†…å®¹**:
- ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆ`db/schemas/member-plans.ts`ï¼‰
- åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆ4ãƒ—ãƒ©ãƒ³ï¼‰
- å‹å®šç¾©ï¼ˆ`types/member-plan.ts`ï¼‰

**éšå±¤çš„ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…**:
```typescript
// Platinumä¼šå“¡ã¯å…¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
// Businessä¼šå“¡ã¯Business + Individualã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
// Individualä¼šå“¡ã¯Individualã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
const canAccessContent = (
  userPlanLevel: number,
  contentPlanLevel: number
) => userPlanLevel >= contentPlanLevel;
```

##### 2. membersãƒ†ãƒ¼ãƒ–ãƒ«ã®æ‹¡å¼µ

**è¿½åŠ ãŒå¿…è¦ãªã‚«ãƒ©ãƒ ï¼ˆç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºï¼‰**:
- æ°åæƒ…å ±: `lastName`, `firstName`, `lastNameKana`, `firstNameKana`
- ä½æ‰€æƒ…å ±: `postalCode`, `prefecture`, `city`, `address`, `building`
- é€£çµ¡å…ˆæƒ…å ±: `phoneNumber`
- ãƒ—ãƒ©ãƒ³æƒ…å ±: `planId`ï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†: `status`, `profileCompleted`, `isActive`
- ãã®ä»–: `email`ï¼ˆæ¤œç´¢æ€§èƒ½å‘ä¸Šã®ãŸã‚ï¼‰

**å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹**:
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ãŒå¿…è¦
- NOT NULLåˆ¶ç´„ã®ã‚ã‚‹ã‚«ãƒ©ãƒ ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¾ãŸã¯ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«å‡¦ç†ãŒå¿…è¦
- ã‚«ã‚¿ã‚«ãƒŠãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…

##### 3. ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®å®Œæˆ

**å®Ÿè£…ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸**:
- `/register/terms` - ä¼šå“¡è¦ç´„åŒæ„
- `/register/plan` - ãƒ—ãƒ©ãƒ³é¸æŠ
- `/profile/complete` - è©³ç´°ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›

**å®Ÿè£…é †åº**:
1. member_plansãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
2. membersãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ è¿½åŠ 
3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒä½œæˆ
4. ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
5. ãƒšãƒ¼ã‚¸å®Ÿè£…
6. ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®çµ±åˆãƒ†ã‚¹ãƒˆ

#### ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå°†æ¥å®Ÿè£… - Stripeæ±ºæ¸ˆçµ±åˆï¼‰

##### 1. membersãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®Stripeé–¢é€£ã‚«ãƒ©ãƒ è¿½åŠ 

**è¿½åŠ ã‚«ãƒ©ãƒ **:
- `paymentCompleted`: æ”¯æ‰•ã„å®Œäº†ãƒ•ãƒ©ã‚°
- `stripeCustomerId`: Stripe Customer ID
- `stripeSubscriptionId`: Stripe Subscription ID
- `stripeSubscriptionStatus`: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- `subscriptionStartedAt` / `subscriptionEndsAt`: æœŸé–“ç®¡ç†
- `lastPaymentAt`: æœ€çµ‚æ”¯æ‰•ã„æ—¥æ™‚

##### 2. member_plansãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®Stripeæƒ…å ±è¿½åŠ 

**è¿½åŠ ã‚«ãƒ©ãƒ **:
- `stripeProductId`: Stripe Product ID
- `stripePriceId`: Stripe Price ID

##### 3. æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…

**å®Ÿè£…ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸**:
- `/register/payment` - æ”¯æ‰•ã„å‡¦ç†
- `/register/payment/success` - æ”¯æ‰•ã„æˆåŠŸ
- `/register/payment/cancel` - æ”¯æ‰•ã„ã‚­ãƒ£ãƒ³ã‚»ãƒ«

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `/api/stripe/create-checkout-session` - Checkout Sessionä½œæˆ
- `/api/stripe/webhook` - Webhookå‡¦ç†
- `/api/stripe/customer-portal` - Customer Portal

##### 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ã®å¤‰æ›´

- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚: `status: "pending_payment"`
- æ±ºæ¸ˆå®Œäº†æ™‚: `status: "pending_profile"`
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œäº†æ™‚: `status: "active"`

#### ãã®ä»–ã®æ‹¡å¼µï¼ˆå„ªå…ˆåº¦ä½ï¼‰

**èªè¨¼æ©Ÿèƒ½ã®æ‹¡å¼µ**:
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç¢ºèªï¼ˆverificationsãƒ†ãƒ¼ãƒ–ãƒ«æ´»ç”¨ï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
- OAuthé€£æºï¼ˆGoogle, GitHubç­‰ï¼‰
- 2æ®µéšèªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ä¼šå“¡æƒ…å ±ç®¡ç†æ©Ÿèƒ½**:
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒšãƒ¼ã‚¸ã®æ‹¡å……
- ä½æ‰€ãƒ»é›»è©±ç•ªå·ã®å¤‰æ›´æ©Ÿèƒ½
- ãƒ—ãƒ©ãƒ³å¤‰æ›´æ©Ÿèƒ½ï¼ˆã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰/ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼‰
- é€€ä¼šå‡¦ç†ï¼ˆ`isActive` ã‚’ false ã«è¨­å®šï¼‰
- ä¼šç¤¾åç®¡ç†ï¼ˆæ³•äººä¼šå“¡å‘ã‘ï¼‰

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸](./database-design-sql.md) - è©³ç´°ãªãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ
- [URLè¨­è¨ˆ](./url-design.md) - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆ
- [ãƒšãƒ¼ã‚¸æ§‹æˆä¸€è¦§](./pages-overview.md) - å…¨ãƒšãƒ¼ã‚¸ã®æ©Ÿèƒ½ä¸€è¦§
- [å®Ÿè£…ã‚¬ã‚¤ãƒ‰](./implementation-guide-generic.md) - CRUDæ©Ÿèƒ½ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

---

**æœ€çµ‚æ›´æ–°**: 2025-10-30
**å¤‰æ›´å†…å®¹**: Stripeæ±ºæ¸ˆã‚’ç¬¬2ãƒ•ã‚§ãƒ¼ã‚ºã«ç§»è¡Œã—ã€ç¬¬1ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯æ±ºæ¸ˆãªã—ã§ä¼šå“¡ç™»éŒ²ã‚’å®Œäº†ã§ãã‚‹ã‚ˆã†ã«å¤‰æ›´
**ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼**: -
**æ‰¿èªè€…**: -
